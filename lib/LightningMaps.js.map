{"version":3,"sources":["webpack://LightningMaps/webpack/universalModuleDefinition","webpack://LightningMaps/webpack/bootstrap","webpack://LightningMaps/./src/Map.js","webpack://LightningMaps/./src/MapState.js","webpack://LightningMaps/./src/Marker.js","webpack://LightningMaps/./src/Polygon.js","webpack://LightningMaps/./src/Tile.js","webpack://LightningMaps/./src/TileConversion.js","webpack://LightningMaps/./src/TileLayer.js","webpack://LightningMaps/./src/defaultOptions.js","webpack://LightningMaps/./src/index.js"],"names":["Map","canvas","options","getContext","Error","context","Object","assign","initializeState","attachEvents","applyStyles","lastDrawState","draw","bind","window","requestAnimationFrame","state","canvasDimensions","width","height","tiles","moveOffset","targetMoveOffset","targetMoveOffsetIsCoord","moveAnimationStart","dragStartPosition","lastEventActionTime","startZoom","zoom","targetZoom","zoomAnimationStart","scale","lastMouseMoveEvent","mouseVelocities","markers","polygons","tileLayers","zoomValueIsValid","push","performance","now","coord","Array","isArray","length","map","parseFloat","x","y","animated","pixelToLatLon","center","tileSize","milliSecondsSinceLastEvent","debounceIntervalMs","position1","position2","time1","time2","addEventListener","event","preventDefault","isReadyForEvent","deltaY","setZoom","centerX","centerY","setTargetMoveOffset","clientX","clientY","timingThreshold","throwTimingThresholdMs","thresholdsToConsider","filter","threshold","velocitySum","reduce","accumulator","velocity","averageVelocity","throwVelocityThreshold","multiplier","panAccelerationMultiplier","Math","min","maxPanAcceleration","updateCenter","vx","calculateVelocity","vy","round","sqrt","style","cursor","time","targetMoveOffsetChanged","timestamp","progress","max","percentage","easeOutQuad","animationDurationMs","latLonToPixel","targetHasBeenReached","latLon","differenceFromTarget","abs","newZoomDiff","remainingTime","roundedZoom","diff","pow","shift","tilesZoomLevel","allTiles","values","maxTilesToKeep","tileExpirationCutOff","Date","getTime","tilesToConsider","tile","lastRequested","sort","a","b","tilesToDeleteCount","splice","forEach","src","tileId","drawState","JSON","stringify","updateMoveOffset","updateZoom","tileLayer","calculateGrid","garbageCollect","shouldRedraw","drawTiles","drawMarkers","drawPolygons","drawAttribution","nw","se","bounds","getMapBounds","visibleMarkers","marker","coords","position","render","mapState","polygon","margin","font","textBounds","measureText","attribution","fillStyle","roundedRectangle","fillText","radius","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","addMarker","MapState","_center","_zoom","_tileSize","_canvasDimensions","_moveOffset","Marker","_coords","_options","renderFunction","type","renderMarker","renderCircle","renderDonut","color","strokeStyle","save","arc","PI","restore","lineWidth","stroke","markerWidth","markerHeight","transform","bezierCurveTo","geoPath","geoTransform","mesh","POLYGON_CACHE","Polygon","sourceUrl","_sourceUrl","_geometry","fetch","then","response","json","catch","err","console","log","message","point","projectPoint","path","cachedPosition","cacheKey","projectedX","projectedY","stream","Tile","_x","_y","join","TileConversion","lon","rounded","floor","lat","tan","cos","z","n","atan","exp","ne","tile2lat","tile2lon","sw","pixel","pointDiff","tileX","lon2tile","tileY","lat2tile","mapDimensions","tileCenterX","tileCenterY","TileLayer","shouldBeDeleted","grid","gridHash","relativeTileOffset","loadedPercentage","canvasSize","tilesCount","ceil","tileAreaMultiplier","gridNeedsToBeUpdated","horizontalTiles","getTilesCount","verticalTiles","centerYRounded","centerXRounded","startX","startY","ensureTileAsset","id","tileUrl","source","Image","loaded","onload","canvasWidth","canvasHeight","centerOffset","fillRect","horizontalOverflow","verticalOverflow","drawImage","drawGenericBackground","debug","strokeRect","size","increment","lineX","lineY","totalTiles","loadedTiles","defaultMapOptions","defaultMarkerOptions","defaultPolygonOptions"],"mappings":"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","file":"LightningMaps.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"LightningMaps\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LightningMaps\"] = factory();\n\telse\n\t\troot[\"LightningMaps\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import TileConversion from './TileConversion';\nimport TileLayer from './TileLayer';\nimport MapState from './MapState';\nimport { defaultMapOptions } from './defaultOptions';\n\nexport default class Map {\n\n  constructor(canvas, options) {\n    if (!canvas || !canvas.getContext) {\n      throw new Error('Could not get canvas context');\n    }\n\n    this.canvas = canvas;\n    this.context = this.canvas.getContext('2d');\n\n    this.options = Object.assign({}, defaultMapOptions, options);\n\n    this.initializeState();\n    this.attachEvents();\n    this.applyStyles();\n\n    this.lastDrawState = null;\n\n    this.draw = this.draw.bind(this);\n    window.requestAnimationFrame(this.draw);\n  }\n\n  initializeState() {\n    this.state = {\n      canvasDimensions: [this.canvas.width, this.canvas.height],\n      tiles: {},\n      moveOffset: [0, 0],\n      targetMoveOffset: [0, 0],\n      targetMoveOffsetIsCoord: false,\n      moveAnimationStart: null,\n      dragStartPosition: null,\n      lastEventActionTime: null,\n      startZoom: this.options.zoom,\n      targetZoom: this.options.zoom,\n      zoomAnimationStart: null,\n      scale: 1,\n      lastMouseMoveEvent: null,\n      mouseVelocities: [],\n      markers: [],\n      polygons: [],\n      tileLayers: [\n        new TileLayer(this)\n      ]\n    };\n  }\n\n  getZoom() {\n    return this.options.zoom;\n  }\n\n  setZoom(zoom) {\n    if (this.zoomValueIsValid(zoom)) {\n      this.state.tileLayers.push(new TileLayer(this, zoom));\n      // this.state.tileLayers[0].tilesZoomLevel = this.options.zoom;\n\n      this.state.lastEventActionTime = window.performance.now();\n      this.state.zoomAnimationStart = window.performance.now();\n      this.state.targetZoom = zoom;\n      this.state.startZoom = this.options.zoom;\n    }\n  }\n\n  setCenter(coord) {\n    if (!Array.isArray(coord) || coord.length !== 2) {\n      throw new Error('Please provide a valid array with a lat/lon');\n    }\n\n    coord = coord.map(coord => parseFloat(coord));\n\n    this.state.moveAnimationStart = window.performance.now();\n    this.state.targetMoveOffset = coord;\n    this.state.targetMoveOffsetIsCoord = true;\n  }\n\n  setTargetMoveOffset(x, y, animated = true) {\n    if (animated) {\n      this.state.moveAnimationStart = window.performance.now();\n\n      this.state.targetMoveOffset = TileConversion.pixelToLatLon(\n        [x, y],\n        this.options.center,\n        this.options.zoom,\n        this.options.tileSize\n      );\n\n      this.state.targetMoveOffsetIsCoord = true;\n    } else {\n      this.state.targetMoveOffset = [x, y];\n      this.state.targetMoveOffsetIsCoord = false;\n\n      this.state.moveOffset = this.state.targetMoveOffset;\n    }\n  }\n\n  zoomValueIsValid(zoom) {\n    return zoom >= 1 && zoom <= 18;\n  }\n\n  isReadyForEvent() {\n    if (!this.state.lastEventActionTime) {\n      return true;\n    }\n\n    const now = window.performance.now();\n    const milliSecondsSinceLastEvent = now - this.state.lastEventActionTime;\n\n    return milliSecondsSinceLastEvent > this.options.debounceIntervalMs;\n  }\n\n  calculateVelocity(position1, position2, time1, time2) {\n    return ((position1 - position2) / (time1 - time2)) * 1000;\n  }\n\n  attachEvents() {\n    this.canvas.addEventListener('wheel', event => {\n      event.preventDefault();\n\n      if (this.isReadyForEvent()) {\n        if (event.deltaY > 5) {\n          this.setZoom(this.options.zoom - 1);\n        } else if (event.deltaY < -5) {\n          this.setZoom(this.options.zoom + 1);\n        }\n      }\n    });\n\n    this.canvas.addEventListener('dblclick', event => {\n      event.preventDefault();\n\n      const centerX = this.state.canvasDimensions[0] / 2;\n      const centerY = this.state.canvasDimensions[1] / 2;\n\n      this.setTargetMoveOffset(\n        -(event.clientX - centerX),\n        -(event.clientY - centerY)\n      );\n\n      this.setZoom(this.options.zoom + 1);\n    });\n\n    this.canvas.addEventListener('mousedown', event => {\n      event.preventDefault();\n\n      this.state.mouseVelocities = [];\n\n      this.state.dragStartPosition = [\n        event.clientX - this.state.moveOffset[0],\n        event.clientY - this.state.moveOffset[1]\n      ];\n    });\n\n    this.canvas.addEventListener('mouseup', event => {\n      event.preventDefault();\n\n      const x = -(this.state.dragStartPosition[0] - event.clientX);\n      const y = -(this.state.dragStartPosition[1] - event.clientY);\n\n      if (this.state.moveOffset[0] !== 0 || this.state.moveOffset[1] !== 0) {\n        const now = window.performance.now();\n        const timingThreshold = now - this.options.throwTimingThresholdMs;\n\n        const thresholdsToConsider = this.state.mouseVelocities\n          .filter(threshold => threshold[0] > timingThreshold)\n          .map(threshold => threshold[1]);\n\n        const velocitySum = thresholdsToConsider.reduce(\n          (accumulator, velocity) => accumulator + velocity,\n          0\n        );\n\n        const averageVelocity = velocitySum / thresholdsToConsider.length;\n\n        if (averageVelocity >= this.options.throwVelocityThreshold) {\n          let multiplier = averageVelocity / this.options.throwVelocityThreshold\n            * this.options.panAccelerationMultiplier;\n\n          multiplier = Math.min(multiplier, this.options.maxPanAcceleration);\n\n          this.setTargetMoveOffset(\n            x * multiplier,\n            y * multiplier\n          );\n        } else {\n          this.updateCenter();\n        }\n      }\n\n      this.state.dragStartPosition = null;\n    });\n\n    this.canvas.addEventListener('mousemove', event => {\n      event.preventDefault();\n\n      if (this.state.dragStartPosition) {\n        const x = -(this.state.dragStartPosition[0] - event.clientX);\n        const y = -(this.state.dragStartPosition[1] - event.clientY);\n\n        const now = window.performance.now();\n\n        const vx = this.calculateVelocity(this.state.moveOffset[0], x, now, this.state.lastMouseMoveEvent);\n        const vy = this.calculateVelocity(this.state.moveOffset[1], y, now, this.state.lastMouseMoveEvent);\n\n        const velocity = Math.round(Math.sqrt((vx * vx) + (vy * vy)));\n\n        this.state.mouseVelocities.push([now, velocity]);\n\n        this.setTargetMoveOffset(x, y, false);\n        this.state.lastMouseMoveEvent = window.performance.now();\n      }\n\n      return false;\n    });\n  }\n\n  applyStyles() {\n    this.canvas.style.cursor = 'grab';\n  }\n\n  easeOutQuad(time) {\n    return time * (2 - time);\n  }\n\n  updateMoveOffset() {\n    const targetMoveOffsetChanged = this.state.moveOffset !== this.state.targetMoveOffset;\n\n    if (targetMoveOffsetChanged) {\n      const timestamp = window.performance.now();\n\n      const progress = Math.max(timestamp - this.state.moveAnimationStart, 0);\n      const percentage = this.easeOutQuad(progress / this.options.animationDurationMs);\n\n      let targetMoveOffset = this.state.targetMoveOffset;\n\n      if (this.state.targetMoveOffsetIsCoord) {\n        targetMoveOffset = TileConversion.latLonToPixel(\n          this.state.targetMoveOffset,\n          this.options.center,\n          this.options.zoom,\n          this.options.tileSize,\n          this.state.canvasDimensions\n        );\n      }\n\n      if (percentage >= 0.99) {\n        this.state.moveOffset = targetMoveOffset;\n      } else {\n        this.state.moveOffset = [\n          this.state.moveOffset[0] + (targetMoveOffset[0] - this.state.moveOffset[0]) * percentage,\n          this.state.moveOffset[1] + (targetMoveOffset[1] - this.state.moveOffset[1]) * percentage\n        ];\n      }\n\n      const targetHasBeenReached = this.state.moveOffset === targetMoveOffset;\n\n      if (targetHasBeenReached) {\n        this.updateCenter();\n      }\n    }\n  }\n\n  updateCenter() {\n    const latLon = TileConversion.pixelToLatLon(\n      this.state.moveOffset,\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize\n    );\n\n    this.setTargetMoveOffset(0, 0, false);\n    this.options.center = latLon;\n  }\n\n  updateZoom() {\n    if (this.options.zoom !== this.state.targetZoom) {\n      const progress = Math.max(window.performance.now() - this.state.zoomAnimationStart, 0);\n      const percentage = this.easeOutQuad(progress / this.options.animationDurationMs);\n\n      let differenceFromTarget = Math.abs(this.state.targetZoom - this.state.startZoom);\n\n      if (this.state.targetZoom <= this.state.startZoom) {\n        differenceFromTarget *= -1;\n      }\n\n      const newZoomDiff = differenceFromTarget * percentage;\n      const remainingTime = this.options.animationDurationMs - progress;\n\n      this.options.zoom = remainingTime <= 5\n        ? this.state.targetZoom\n        : (this.state.startZoom + newZoomDiff);\n\n      const roundedZoom = Math.round(this.options.zoom);\n      const diff = this.options.zoom - roundedZoom;\n\n      this.state.scale = Math.pow(2, diff);\n\n      if (this.options.zoom === this.state.targetZoom) {\n        // Mark old tile layer for deletion\n        this.state.tileLayers.shift();\n        this.state.tileLayers[0].tilesZoomLevel = null;\n\n        // this.state.tileLayers[this.state.tileLayers.length - 1].shouldBeDeleted = true;\n      }\n    } else {\n      this.state.scale = 1;\n    }\n  }\n\n  garbageCollect() {\n    const allTiles = Object.values(this.state.tiles);\n\n    if (allTiles.length > this.maxTilesToKeep()) {\n      const tileExpirationCutOff = new Date().getTime() - 5000;\n\n      const tilesToConsider = allTiles\n        .filter(tile => tile.lastRequested < tileExpirationCutOff)\n        .sort((a, b) => ~~(a.lastRequested < b.lastRequested));\n\n      const tilesToDeleteCount = this.maxTilesToKeep() - (allTiles.length - tilesToConsider.length);\n\n      tilesToConsider\n        .splice(tilesToConsider.length - tilesToDeleteCount)\n        .forEach(tile => {\n          tile.src = '';\n          delete this.state.tiles[tile.tileId];\n        });\n    }\n  }\n\n  maxTilesToKeep() {\n    return 1000;\n  }\n\n  shouldRedraw() {\n    const drawState = JSON.stringify([this.state, this.options]);\n\n    if (this.lastDrawState !== drawState) {\n      this.lastDrawState = drawState;\n\n      return true;\n    }\n\n    return false;\n  }\n\n  draw() {\n    this.updateMoveOffset();\n    this.updateZoom();\n    this.state.tileLayers.forEach(tileLayer => tileLayer.calculateGrid());\n    this.garbageCollect();\n\n    if (this.shouldRedraw()) {\n      // Delete tile layers that are ready for deletion and mostly loaded\n      /*\n      this.state.tileLayers = this.state.tileLayers\n        .filter(tileLayer => !(tileLayer.shouldBeDeleted && tileLayer.loadedPercentage() >= 0.9));\n\n      console.log(this.state.tileLayers.length);\n      */\n\n      if (this.state.tileLayers.length > 0) {\n        // Only draw the top layer\n        this.state.tileLayers[0].drawTiles(this.state.scale);\n      }\n\n      this.drawMarkers();\n      this.drawPolygons();\n      this.drawAttribution();\n    }\n\n    window.requestAnimationFrame(this.draw);\n  }\n\n  getMapBounds() {\n    const nw = TileConversion.pixelToLatLon(\n      [this.state.canvasDimensions[0] / 2, (this.state.canvasDimensions[1] / 2)],\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize\n    );\n\n    const se = TileConversion.pixelToLatLon(\n      [-this.state.canvasDimensions[0] / 2, -(this.state.canvasDimensions[1] / 2)],\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize\n    );\n\n    return {\n      nw, se\n    };\n  }\n\n  drawMarkers() {\n    const bounds = this.getMapBounds();\n\n    const visibleMarkers = this.state.markers.filter(marker => {\n      return marker.coords[0] <= bounds.nw[0] && marker.coords[0] >= bounds.se[0]\n        && marker.coords[1] >= bounds.nw[1] && marker.coords[1] <= bounds.se[1];\n    });\n\n    const center = [\n      this.state.canvasDimensions[0] / 2,\n      this.state.canvasDimensions[1] / 2\n    ];\n\n    visibleMarkers.map(marker => {\n      const position = TileConversion.latLonToPixel(\n        marker.coords,\n        this.options.center,\n        this.options.zoom,\n        this.options.tileSize,\n        this.state.canvasDimensions\n      );\n\n      marker.render(this.context, [\n        center[0] - position[0] + this.state.moveOffset[0],\n        center[1] - position[1] + this.state.moveOffset[1]\n      ]);\n    });\n  }\n\n  drawPolygons() {\n    const mapState = new MapState(\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize,\n      this.state.canvasDimensions,\n      this.state.moveOffset\n    );\n\n    this.state.polygons.map(polygon => {\n      polygon.render(this.context, mapState);\n    });\n  }\n\n  drawAttribution() {\n    const margin = 4;\n\n    this.context.font = 'bold 12px sans-serif';\n    const textBounds = this.context.measureText(this.options.attribution);\n\n    const x = this.state.canvasDimensions[0] - textBounds.width - margin;\n    const y = this.state.canvasDimensions[1] - 2 - margin;\n\n    this.context.fillStyle = 'rgba(255, 255, 255, 0.7)';\n    this.roundedRectangle(x - margin, y - 15, textBounds.width + 80, 80);\n\n    this.context.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    this.context.fillText(this.options.attribution, x, y);\n\n  }\n\n  roundedRectangle(x, y, width, height) {\n    const radius = 5;\n\n    this.context.beginPath();\n    this.context.moveTo(x + radius, y);\n    this.context.lineTo(x + width - radius, y);\n    this.context.quadraticCurveTo(x + width, y, x + width, y + radius);\n    this.context.lineTo(x + width, y + height - radius);\n    this.context.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    this.context.lineTo(x + radius, y + height);\n    this.context.quadraticCurveTo(x, y + height, x, y + height - radius);\n    this.context.lineTo(x, y + radius);\n    this.context.quadraticCurveTo(x, y, x + radius, y);\n    this.context.closePath();\n\n    this.context.fill();\n  }\n\n  addMarker(marker) {\n    this.state.markers.push(marker);\n  }\n\n  addMarkers(markers) {\n    markers.map(marker => this.addMarker(marker));\n  }\n\n  addPolygon(polygon) {\n    this.state.polygons.push(polygon);\n  }\n\n}\n","export default class MapState {\n  constructor(center, zoom, tileSize, canvasDimensions, moveOffset) {\n    this._center = center;\n    this._zoom = zoom;\n    this._tileSize = tileSize;\n    this._canvasDimensions = canvasDimensions;\n    this._moveOffset = moveOffset;\n  }\n\n  get center() {\n    return this._center;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get tileSize() {\n    return this._tileSize;\n  }\n\n  get canvasDimensions() {\n    return this._canvasDimensions;\n  }\n\n  get moveOffset() {\n    return this._moveOffset;\n  }\n}\n","import { defaultMarkerOptions } from './defaultOptions';\n\nexport default class Marker {\n  constructor(coords, options = {}) {\n    this._coords = coords;\n    this._options = Object.assign({}, defaultMarkerOptions, options);\n  }\n\n  get coords() {\n    return this._coords;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  render(context, position) {\n    let renderFunction = null;\n\n    switch (this.options.type) {\n      case 'marker':\n        renderFunction = this.renderMarker;\n        break;\n\n      case 'circle':\n        renderFunction = this.renderCircle;\n        break;\n\n      case 'donut':\n        renderFunction = this.renderDonut;\n        break;\n    }\n\n    if (!renderFunction) {\n      throw new Error(`Unsupported marker type: \"${this.options.type}\"`);\n    } else {\n      context.fillStyle = this.options.color;\n      context.strokeStyle = this.options.color;\n\n      renderFunction = renderFunction.bind(this);\n      renderFunction(context, position);\n    }\n  }\n\n  renderCircle(context, position) {\n    context.save();\n    context.beginPath();\n    context.arc(position[0], position[1], 5, 0, 2 * Math.PI);\n    context.fill();\n    context.restore();\n  }\n\n  renderDonut(context, position) {\n    context.save();\n    context.beginPath();\n    context.lineWidth = 5;\n    context.arc(position[0], position[1], 7, 0, 2 * Math.PI);\n    context.stroke();\n    context.restore();\n  }\n\n  renderMarker(context, position) {\n    const markerWidth = 17.698069;\n    const markerHeight = 24.786272;\n\n    const x = position[0] - markerWidth / 2;\n    const y = position[1] - markerHeight;\n\n    context.save();\n    context.transform(0.184386, 0.000000, 0.000000, 0.184386, 0.551658 + x, 4.095760 + y);\n    context.beginPath();\n    context.lineWidth = 1.667195;\n    context.moveTo(45.000000, -22.212949);\n    context.bezierCurveTo(18.494941, -22.212949, -2.991863, -0.726145, -2.991863, 25.778914);\n    context.bezierCurveTo(-2.991863, 52.282306, 45.000000, 112.212950, 45.000000, 112.212950);\n    context.bezierCurveTo(45.000000, 112.212950, 92.991863, 52.282306, 92.991863, 25.777247);\n    context.bezierCurveTo(92.991863, -0.726145, 71.505059, -22.212949, 45.000000, -22.212949);\n    context.moveTo(45.000000, 43.827962);\n    context.bezierCurveTo(33.553042, 43.827962, 24.273437, 34.550024, 24.273437, 23.103067);\n    context.bezierCurveTo(24.273437, 11.656109, 33.553042, 2.376504, 45.000000, 2.376504);\n    context.bezierCurveTo(56.446958, 2.376504, 65.726563, 11.654442, 65.726563, 23.101399);\n    context.bezierCurveTo(65.726563, 34.548357, 56.446958, 43.827962, 45.000000, 43.827962);\n    context.fill();\n    context.restore();\n  }\n}\n","import { defaultPolygonOptions } from './defaultOptions';\nimport TileConversion from './TileConversion';\n// import { geoPath, geoTransform } from 'd3-geo';\n// import { mesh } from 'topojson-client';\n\nfunction geoPath() {\n\n}\n\nfunction geoTransform() {\n\n}\n\nfunction mesh() {\n\n}\n\nconst POLYGON_CACHE = {};\n\nexport default class Polygon {\n  constructor(sourceUrl, options = {}) {\n    this._sourceUrl = sourceUrl;\n    this._options = Object.assign({}, defaultPolygonOptions, options);\n    this._geometry = null;\n\n    fetch(this._sourceUrl)\n      .then(response => response.json())\n      .then(json => {\n        this._geometry = json;\n      })\n      .catch(err => console.log(`Could not load ${this._sourceUrl}: ${err.message || err}`));\n  }\n\n  get sourceUrl() {\n    return this._sourceUrl;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  render(context, mapState) {\n    if (!this._geometry) {\n      return;\n    }\n\n    context.fillStyle = this.options.color;\n    context.strokeStyle = this.options.color;\n\n    this.mapState = mapState;\n\n    const center = [\n      this.mapState.canvasDimensions[0] / 2,\n      this.mapState.canvasDimensions[1] / 2\n    ];\n\n    const transform = geoTransform({point: this.projectPoint, mapState, center });\n\n    const path = geoPath(transform).context(context);\n\n    context.beginPath();\n    path(mesh(this._geometry));\n    context.stroke();\n  }\n\n  projectPoint(x, y) {\n    const cachedPosition = (x, y, mapState) => {\n      const cacheKey = JSON.stringify([\n        [y, x], this.mapState.center, this.mapState.zoom,\n        this.mapState.tileSize, this.mapState.canvasDimensions\n      ]);\n\n      if (cacheKey in POLYGON_CACHE) {\n        return POLYGON_CACHE[cacheKey];\n      }\n\n      const position = TileConversion.latLonToPixel(\n        [y, x],\n        this.mapState.center,\n        this.mapState.zoom,\n        this.mapState.tileSize,\n        this.mapState.canvasDimensions\n      );\n\n      POLYGON_CACHE[cacheKey] = position;\n\n      return position;\n    };\n\n    const position = cachedPosition(x, y, this.mapState);\n\n    const projectedX = this.center[0] - position[0] + this.mapState.moveOffset[0];\n    const projectedY = this.center[1] - position[1] + this.mapState.moveOffset[1];\n\n    this.stream.point(projectedX, projectedY);\n  }\n}\n","export default class Tile {\n  constructor(x, y, zoom) {\n    this._x = x;\n    this._y = y;\n    this._zoom = zoom;\n  }\n\n  get x() {\n    return this._x;\n  }\n\n  get y() {\n    return this._y;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get id() {\n    return [this.x, this.y, this.zoom].join('|');\n  }\n}\n","// Based on https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#ECMAScript_.28JavaScript.2FActionScript.2C_etc..29\nexport default class TileConversion {\n  static lon2tile(lon, zoom, rounded = true) {\n    const tile = (lon + 180) / 360 * Math.pow(2, zoom);\n\n    return rounded\n      ? Math.floor(tile)\n      : tile;\n  }\n\n  static lat2tile(lat, zoom, rounded = true) {\n    const tile = (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180))\n      / Math.PI) / 2 * Math.pow(2, zoom);\n\n    return rounded\n      ? Math.floor(tile)\n      : tile;\n  }\n\n  static tile2lon(x, z) {\n    return x / Math.pow(2, z) * 360 - 180;\n  }\n\n  static tile2lat(y, z) {\n    const n = Math.PI - 2 * Math.PI * y / Math.pow(2, z);\n\n    return 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  }\n\n  static tile2boundingBox(x, y, zoom) {\n    return {\n      ne: [\n        TileConversion.tile2lat(y, zoom),\n        TileConversion.tile2lon(x + 1, zoom)\n      ],\n\n      sw: [\n        TileConversion.tile2lat(y + 1, zoom),\n        TileConversion.tile2lon(x, zoom)\n      ]\n    };\n  }\n\n  static pixelToLatLon(pixel, center, zoom, tileSize) {\n    const pointDiff = [\n      pixel[0] / tileSize,\n      pixel[1] / tileSize\n    ];\n\n    const tileX = TileConversion.lon2tile(center[1], zoom, false) - pointDiff[0];\n    const tileY = TileConversion.lat2tile(center[0], zoom, false) - pointDiff[1];\n\n    return [\n      TileConversion.tile2lat(tileY, zoom),\n      TileConversion.tile2lon(tileX, zoom)\n    ];\n  }\n\n  static latLonToPixel(coord, center, zoom, tileSize, mapDimensions) {\n    const tileX = TileConversion.lon2tile(coord[1], zoom, false);\n    const tileY = TileConversion.lat2tile(coord[0], zoom, false);\n\n    const tileCenterX = TileConversion.lon2tile(center[1], zoom, false);\n    const tileCenterY = TileConversion.lat2tile(center[0], zoom, false);\n\n    return [\n      -(tileX - tileCenterX) * tileSize,\n      -(tileY - tileCenterY) * tileSize\n    ];\n  }\n}\n","import TileConversion from './TileConversion';\nimport Tile from './Tile';\n\nexport default class TileLayer {\n\n  constructor(map, tilesZoomLevel = null) {\n    this.map = map;\n    this.tilesZoomLevel = tilesZoomLevel;\n    this.shouldBeDeleted = false;\n\n    this.context = map.context;\n\n    this.state = {\n      grid: [],\n      gridHash: null,\n      relativeTileOffset: [0, 0]\n    };\n  }\n\n  toJSON() {\n    return [\n      this.state,\n      this.loadedPercentage() // We want a change in loaded tiles to possibly trigger a redraw\n    ];\n  }\n\n  getTilesCount(canvasSize) {\n    let tilesCount = Math.ceil(canvasSize / this.map.options.tileSize) * this.map.options.tileAreaMultiplier;\n\n    if (tilesCount % 2 === 0) {\n      tilesCount++;\n    }\n\n    return tilesCount;\n  }\n\n  calculateGrid() {\n    const { state, options } = this.map;\n\n    const centerY = TileConversion.lat2tile(options.center[0], Math.round(this.tilesZoomLevel || options.zoom), false);\n    const centerX = TileConversion.lon2tile(options.center[1], Math.round(this.tilesZoomLevel || options.zoom), false);\n    const gridHash = [centerY, centerX].join(',');\n\n    const gridNeedsToBeUpdated = this.state.gridHash !== gridHash;\n\n    if (!gridNeedsToBeUpdated) {\n      return;\n    }\n\n    const horizontalTiles = this.getTilesCount(state.canvasDimensions[0]);\n    const verticalTiles = this.getTilesCount(state.canvasDimensions[1]);\n\n    // noinspection JSSuspiciousNameCombination\n    const centerYRounded = Math.floor(centerY);\n    const centerXRounded = Math.floor(centerX);\n\n    this.state.relativeTileOffset = [\n      Math.abs(centerX - centerXRounded),\n      Math.abs(centerY - centerYRounded)\n    ];\n\n    const startX = centerXRounded - Math.floor(horizontalTiles / 2);\n    const startY = centerYRounded - Math.floor(verticalTiles / 2);\n\n    let grid = [];\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        if (!grid[x]) {\n          grid[x] = [];\n        }\n\n        const tileX = startX + x;\n        const tileY = startY + y;\n\n        if (tileX >= 0 && tileY >= 0) {\n          grid[x][y] = new Tile(tileX, tileY, Math.round(this.tilesZoomLevel || options.zoom));\n          this.ensureTileAsset(grid[x][y]);\n        }\n      }\n    }\n\n    this.state.grid = grid;\n    this.state.gridHash = gridHash;\n  }\n\n  ensureTileAsset(tile) {\n    if (!(tile.id in this.map.state.tiles)) {\n      const tileUrl = this.map.options.source(Math.floor(tile.x), Math.floor(tile.y), tile.zoom);\n\n      this.map.state.tiles[tile.id] = new Image();\n      this.map.state.tiles[tile.id].tileId = tile.id;\n      this.map.state.tiles[tile.id].src = tileUrl;\n      this.map.state.tiles[tile.id].loaded = false;\n      this.map.state.tiles[tile.id].onload = () => {\n        this.map.state.tiles[tile.id].loaded = true;\n      };\n    }\n\n    this.map.state.tiles[tile.id].lastRequested = new Date().getTime();\n  }\n\n  drawTiles(scale) {\n    const canvasWidth = this.map.state.canvasDimensions[0];\n    const canvasHeight = this.map.state.canvasDimensions[1];\n\n    const tileSize = this.map.options.tileSize * scale;\n\n    const centerOffset = [\n      tileSize / 2 - (this.state.relativeTileOffset[0] * tileSize),\n      tileSize / 2 - (this.state.relativeTileOffset[1] * tileSize)\n    ];\n\n    this.context.fillStyle = '#EEE';\n    this.context.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    const horizontalTiles = this.getTilesCount(canvasWidth);\n    const verticalTiles = this.getTilesCount(canvasHeight);\n\n    const horizontalOverflow = (horizontalTiles * tileSize) - canvasWidth;\n    const verticalOverflow = (verticalTiles * tileSize) - canvasHeight;\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        const tile = this.state.grid[x][y];\n\n        if (tile) {\n          const tileX = this.map.state.moveOffset[0] + centerOffset[0]\n            + (x * tileSize - horizontalOverflow / 2);\n\n          const tileY = this.map.state.moveOffset[1] + centerOffset[1]\n            + (y * tileSize - verticalOverflow / 2);\n\n          try {\n            if (this.map.state.tiles[tile.id].loaded) {\n              this.context.drawImage(this.map.state.tiles[tile.id], tileX, tileY, tileSize, tileSize);\n            } else {\n              this.drawGenericBackground(tileX, tileY, tileSize);\n            }\n          } catch (err) {\n            this.drawGenericBackground(tileX, tileY, tileSize);\n          }\n\n          if (this.map.options.debug) {\n            this.context.strokeStyle = 'green';\n            this.context.strokeRect(tileX, tileY, tileSize, tileSize);\n          }\n        }\n      }\n    }\n\n    if (this.map.options.debug) {\n      this.context.fillStyle = 'rgba(200, 0, 0, 0.7)';\n      this.context.beginPath();\n      this.context.arc(canvasWidth / 2, canvasHeight / 2, 5, 0, 2 * Math.PI);\n      this.context.fill();\n    }\n  }\n\n  drawGenericBackground(x, y, size) {\n    const increment = size / 8;\n\n    this.context.beginPath();\n    for (let lineX = increment; lineX < size; lineX += increment) {\n      for (let lineY = increment; lineY < size; lineY += increment) {\n        this.context.moveTo(x, y + lineY);\n        this.context.lineTo(x + size, y + lineY);\n\n        this.context.moveTo(x + lineX, y);\n        this.context.lineTo(x + lineX, y + size);\n      }\n    }\n    this.context.strokeStyle = '#DDD';\n    this.context.stroke();\n\n    this.context.strokeStyle = '#CCC';\n    this.context.strokeRect(x, y, size, size);\n  }\n\n  loadedPercentage() {\n    const horizontalTiles = this.getTilesCount(this.map.state.canvasDimensions[0]);\n    const verticalTiles = this.getTilesCount(this.map.state.canvasDimensions[1]);\n\n    const totalTiles = horizontalTiles * verticalTiles;\n    let loadedTiles = 0;\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        const tile = this.state.grid[x][y];\n\n        if (this.map.state.tiles[tile.id].loaded) {\n          loadedTiles++;\n        }\n      }\n    }\n\n    return loadedTiles / totalTiles;\n  }\n}\n","export const defaultMapOptions = {\n  /**\n   * Common options\n   */\n  source: (x, y, z) => `https://maps.geocod.io/tiles/base/${z}/${x}/${y}.png`,\n  zoom: 12,\n  center: [38.841779, -77.088312],\n  attribution: ' OpenStreetMap contributors',\n\n  /**\n   * Width and height in pixels for each tile, you most likely do not want to change this.\n   */\n  tileSize: 256,\n\n  /**\n   * Determines the distance travelled when panning the map, the higher the value the further the\n   * distance\n   */\n  panAccelerationMultiplier: 2,\n\n  /**\n   * The maximum acceleration constant for when the map is thrown. This is in place to avoid\n   * super-sonic acceleration speeds :)\n   */\n  maxPanAcceleration: 3.5,\n\n  /**\n   * Only consider high velocity mouse movements that has been performed within this timing\n   * threshold (in milliseconds)\n   */\n  throwTimingThresholdMs: 100,\n\n  /**\n   * If the mouse panning velocity is above this threshold, it is considering a throw rather than\n   * a regular pan. We use this to pan further when the mouse is moved quickly\n   */\n  throwVelocityThreshold: 3000,\n\n  /**\n   * How quickly panning and zooming animations are executed (in milliseconds)\n   */\n  animationDurationMs: 300,\n\n  /*\n   * Used for debouncing events such as scrolling\n   */\n  debounceIntervalMs: 200,\n\n  /**\n   * Determines how many additional tiles that should be loaded, to decrease map load times when\n   * panning the map around\n\n   * Minimum value: 1.25\n   */\n  tileAreaMultiplier: 2,\n\n  /**\n   * When debug mode is enabled, additional rendering artifacts are drawn. Should only be used in\n   * conjuction with development of the library\n   */\n  debug: false\n};\n\nexport const defaultMarkerOptions = {\n  /**\n   * What color should the marker be?\n   * Supports hex, rgb and rgba values\n   */\n  color: 'rgba(0, 0, 200, 0.7)',\n\n  /**\n   * Valid values: marker, circle, donut\n   */\n  type: 'marker'\n};\n\nexport const defaultPolygonOptions = {\n  /**\n   * What color should the polygon be?\n   * Supports hex, rgb and rgba values\n   */\n  color: 'rgba(0, 0, 200, 0.7)'\n};\n","import Map from './Map';\nimport Marker from './Marker';\nimport Polygon from './Polygon';\n\nexport default {\n  Map,\n  Marker,\n  Polygon\n};\n"],"sourceRoot":""}