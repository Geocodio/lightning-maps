{"version":3,"sources":["webpack://LightningMaps/webpack/universalModuleDefinition","webpack://LightningMaps/webpack/bootstrap","webpack://LightningMaps/./node_modules/robust-orientation/orientation.js","webpack://LightningMaps/./node_modules/robust-point-in-polygon/robust-pnp.js","webpack://LightningMaps/./node_modules/robust-scale/robust-scale.js","webpack://LightningMaps/./node_modules/robust-subtract/robust-diff.js","webpack://LightningMaps/./node_modules/robust-sum/robust-sum.js","webpack://LightningMaps/./node_modules/topojson-client/index.js","webpack://LightningMaps/./node_modules/topojson-client/src/bbox.js","webpack://LightningMaps/./node_modules/topojson-client/src/bisect.js","webpack://LightningMaps/./node_modules/topojson-client/src/feature.js","webpack://LightningMaps/./node_modules/topojson-client/src/identity.js","webpack://LightningMaps/./node_modules/topojson-client/src/merge.js","webpack://LightningMaps/./node_modules/topojson-client/src/mesh.js","webpack://LightningMaps/./node_modules/topojson-client/src/neighbors.js","webpack://LightningMaps/./node_modules/topojson-client/src/quantize.js","webpack://LightningMaps/./node_modules/topojson-client/src/reverse.js","webpack://LightningMaps/./node_modules/topojson-client/src/stitch.js","webpack://LightningMaps/./node_modules/topojson-client/src/transform.js","webpack://LightningMaps/./node_modules/topojson-client/src/untransform.js","webpack://LightningMaps/./node_modules/two-product/two-product.js","webpack://LightningMaps/./node_modules/two-sum/two-sum.js","webpack://LightningMaps/./src/Map.js","webpack://LightningMaps/./src/MapState.js","webpack://LightningMaps/./src/Marker.js","webpack://LightningMaps/./src/Polygon.js","webpack://LightningMaps/./src/Tile.js","webpack://LightningMaps/./src/TileConversion.js","webpack://LightningMaps/./src/TileLayer.js","webpack://LightningMaps/./src/defaultOptions.js","webpack://LightningMaps/./src/index.js"],"names":["Map","canvas","options","getContext","Error","context","Object","assign","defaultMapOptions","initializeState","attachEvents","lastDrawState","onMarkerClicked","onMarkerHover","onPolygonHover","draw","bind","window","requestAnimationFrame","state","canvasDimensions","width","height","tiles","moveOffset","targetMoveOffset","targetMoveOffsetIsCoord","moveAnimationStart","dragStartPosition","lastZoomEventActionTime","startZoom","zoom","targetZoom","zoomAnimationStart","scale","lastMouseMoveEvent","mouseVelocities","markers","polygons","tileLayers","TileLayer","mousePosition","x","y","forceRedraw","zoomValueIsValid","isReadyForZoomEvent","Math","round","push","performance","now","coord","Array","isArray","length","map","parseFloat","animated","TileConversion","pixelToLatLon","center","tileSize","milliSecondsSinceLastEvent","debounceIntervalMs","position1","position2","time1","time2","addEventListener","event","preventDefault","deltaY","setZoom","updateMousePosition","canvasCenter","getCanvasCenter","setTargetMoveOffset","handleMouseEventInteraction","timingThreshold","throwTimingThresholdMs","thresholdsToConsider","filter","threshold","velocitySum","reduce","accumulator","velocity","averageVelocity","throwVelocityThreshold","multiplier","panAccelerationMultiplier","min","maxPanAcceleration","updateCenter","vx","calculateVelocity","vy","sqrt","rect","getBoundingClientRect","clientX","left","clientY","top","time","targetMoveOffsetChanged","timestamp","progress","max","percentage","easeOutQuad","animationDurationMs","latLonToPixel","targetHasBeenReached","latLon","differenceFromTarget","abs","newZoomDiff","remainingTime","roundedZoom","diff","pow","shift","tilesZoomLevel","allTiles","values","maxTilesToKeep","tileExpirationCutOff","Date","getTime","tilesToConsider","tile","lastRequested","sort","a","b","tilesToDeleteCount","splice","forEach","src","tileId","drawState","JSON","stringify","updateMoveOffset","updateZoom","tileLayer","calculateGrid","garbageCollect","shouldRedraw","drawTiles","renderPolygons","renderMarkers","renderControls","renderAttribution","nw","se","bounds","getMapBounds","marker","coords","visibleMarkers","getVisibleMarkers","position","render","mapState","MapState","polygon","isCurrentlyDraggingMap","handleMouseOver","name","controlObjects","getControlObjects","item","isMouseOverObject","getMarkersBounds","controlObject","label","controlsOrMarkersIsHover","polygonIsHover","style","cursor","margin","size","markerSize","markerOffset","offset","renderControl","radius","fillStyle","roundedRectangle","font","textAlign","textBaseline","fillText","textBounds","measureText","attribution","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","fill","addMarker","_center","_zoom","_targetZoom","_tileSize","_canvasDimensions","_moveOffset","Marker","_coords","_options","defaultMarkerOptions","renderFunction","type","renderMarker","renderCircle","renderDonut","renderImage","color","strokeStyle","save","arc","PI","restore","lineWidth","stroke","transform","bezierCurveTo","image","drawImage","Polygon","json","objectName","hoverOptions","defaultPolygonOptions","_hoverOptions","defaultPolygonHoverOptions","globalIndex","prepareGlobalDataObject","keys","objects","join","geometry","feature","lightningMapsPolygons","index","projectedGeometry","currentlyZooming","originZoom","determineOriginZoom","centerOffset","calculateCenterOffset","point","isHover","list","classifyPoint","applyContextStyles","enableStroke","enableFill","lon2tile","lat2tile","zoomDiff","mapCenterChanged","renderedMapCenter","mapZoomChanged","renderedZoomLevel","shouldReRender","features","projectGeometry","calculatePolygonExtends","imagePosition","polygonExtends","minX","minY","imageRect","floor","right","ceil","bottom","renderOffscreenCanvas","imageDrawPosition","scaledWidth","polygonDimensions","scaledHeight","offscreenCanvas","clipRect","document","createElement","maxX","maxY","mapGeometry","offscreenContext","createOffscreenCanvas","pointsInClipRect","setLineDash","lineDash","lineJoin","pointCallback","coordinates","projectPoint","Tile","_x","_y","lon","rounded","lat","log","tan","cos","z","n","atan","exp","ne","tile2lat","tile2lon","sw","pixel","pointDiff","tileX","tileY","tileCenterX","tileCenterY","shouldBeDeleted","grid","gridHash","relativeTileOffset","loadedPercentage","canvasSize","tilesCount","tileAreaMultiplier","centerY","centerX","gridNeedsToBeUpdated","horizontalTiles","getTilesCount","verticalTiles","centerYRounded","centerXRounded","startX","startY","isValid","ensureTileAsset","id","tileUrl","source","Image","loaded","onload","canvasWidth","canvasHeight","fillRect","horizontalOverflow","verticalOverflow","drawGenericBackground","err","debug","strokeRect","increment","lineX","lineY","totalTiles","loadedTiles","cachedTile"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;ACVA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;;AAGA;AACA;;;;;;;;;;;;;AClFY;;AAEZ,iBAAiB,mBAAO,CAAC,8DAAa;AACtC,gBAAgB,mBAAO,CAAC,2DAAY;AACpC,kBAAkB,mBAAO,CAAC,iEAAc;AACxC,qBAAqB,mBAAO,CAAC,sEAAiB;;AAE9C;;AAEA;AACA;AACA;;AAEA;AACA;AACA,cAAc,YAAY;AAC1B;AACA,oBAAoB,YAAY;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,cAAc,KAAK;AACnB;AACA,gBAAgB,KAAK;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,GAAG;AACH;AACA,gBAAgB,YAAY;AAC5B;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,cAAc,KAAK;AACnB;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0DAA0D,+CAA+C;AACzG,uBAAuB;AACvB;AACA;AACA;;AAEA;AACA;;AAEA;AACA,2BAA2B,WAAW;AACtC,2BAA2B,WAAW;AACtC,+B;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,eAAe;AAC7B;AACA;AACA;AACA;AACA,gDAAgD,yBAAyB,uBAAuB;AAChG;AACA,cAAc,eAAe;AAC7B,2EAA2E;AAC3E;AACA,cAAc,kCAAkC,YAAY,mBAAmB,KAAK,mBAAmB,gBAAgB;AACvH;;AAEA;AACA;AACA,cAAc,eAAe;AAC7B;AACA;AACA;;AAEA,yB;;;;;;;;;;;AC7LA;;AAEA,aAAa,mBAAO,CAAC,4EAAoB;;AAEzC;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB,OAAO;AAChC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;ACnGY;;AAEZ,iBAAiB,mBAAO,CAAC,8DAAa;AACtC,aAAa,mBAAO,CAAC,kDAAS;;AAE9B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,KAAK;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;ACjDY;;AAEZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,K;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;AC3JY;;AAEZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,K;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;AC3JA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAA2C;AACM;AACI;AACG;AACH;AACF;AACE;AACI;;;;;;;;;;;;;ACPzD;AAAA;AAAoC;;AAErB;AACf,UAAU,0DAAS;AACnB;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,oEAAoE;AACpE,6CAA6C;AAC7C,0DAA0D;AAC1D;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;AACA,CAAC;;;;;;;;;;;;;ACtCD;AAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;ACRD;AAAA;AAAA;AAAA;AAAA;AAAgC;AACI;;AAErB;AACf;AACA,SAAS,mEAAmE,6BAA6B,EAAE;AAC3G;AACA,CAAC;;AAEM;AACP;AACA;AACA,4CAA4C;AAC5C;AACA,uCAAuC;AACvC,wBAAwB;AACxB,SAAS;AACT;;AAEO;AACP,uBAAuB,0DAAS;AAChC;;AAEA;AACA;AACA,2DAA2D,OAAO;AAClE;AACA;AACA,eAAe,wDAAO;AACtB;;AAEA;AACA;AACA;;AAEA;AACA;AACA,oCAAoC,OAAO;AAC3C,kDAAkD;AAClD;AACA;;AAEA;AACA;AACA,qDAAqD;AACrD;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA,yCAAyC;AACzC,uDAAuD;AACvD,gEAAgE;AAChE,oDAAoD;AACpD,6DAA6D;AAC7D,oDAAoD;AACpD,6DAA6D;AAC7D;AACA;AACA,YAAY;AACZ;;AAEA;AACA;;;;;;;;;;;;;ACpEA;AAAe;AACf;AACA,CAAC;;;;;;;;;;;;;ACFD;AAAA;AAAA;AAAA;AAAiC;AACH;;AAE9B;AACA;AACA;AACA,wBAAwB;AACxB;;AAEe;AACf,SAAS,uDAAM;AACf,CAAC;;AAEM;AACP,wBAAwB;AACxB;AACA;;AAEA;;AAEA;AACA;AACA,gEAAgE;AAChE,sCAAsC;AACtC,mDAAmD;AACnD;AACA;;AAEA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;;AAEA;AACA,0BAA0B,uDAAM,YAAY,8BAA8B;AAC1E;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,WAAW;AACX,SAAS;AACT;AACA;AACA,GAAG;;AAEH;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,WAAW;AACX,SAAS;AACT,OAAO;;AAEP;AACA,aAAa,uDAAM;;AAEnB;AACA;AACA;AACA;AACA,iDAAiD,OAAO;AACxD;AACA;AACA;AACA;AACA;;AAEA;AACA,KAAK;AACL;AACA;;;;;;;;;;;;;ACpGA;AAAA;AAAA;AAAA;AAAiC;AACH;;AAEf;AACf,SAAS,uDAAM;AACf,CAAC;;AAEM;AACP;AACA;AACA,8DAA8D,OAAO;AACrE,UAAU,+BAA+B,uDAAM;AAC/C;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,kDAAkD,cAAc;AAChE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,gEAAgE;AAChE,0CAA0C;AAC1C,+DAA+D;AAC/D,4CAA4C;AAC5C;AACA;;AAEA;;AAEA;AACA,yBAAyB,uBAAuB;AAChD,yBAAyB,0EAA0E,EAAE;;AAErG;AACA;;;;;;;;;;;;;ACpDA;AAAA;AAA8B;;AAEf;AACf,uBAAuB;AACvB,0CAA0C,WAAW,EAAE;;AAEvD;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA,gCAAgC,cAAc,EAAE;AAChD;;AAEA;AACA,2EAA2E,gBAAgB,EAAE;AAC7F;AACA;;AAEA;AACA;AACA;AACA;AACA,qCAAqC,6BAA6B,iBAAiB,EAAE,EAAE;AACvF;;AAEA;;AAEA;AACA,kEAAkE,OAAO;AACzE,yBAAyB,OAAO;AAChC;AACA,oCAAoC,uDAAM;AAC1C,oCAAoC,uDAAM;AAC1C;AACA;AACA;;AAEA;AACA,CAAC;;;;;;;;;;;;;AC5CD;AAAA;AAAA;AAA0B;AACc;;AAEzB;AACf;;AAEA;AACA;AACA,2BAA2B,qDAAI;AAC/B;AACA,iBAAiB;AACjB,GAAG;AACH;AACA;;AAEA,UAAU,4DAAW;;AAErB;AACA;AACA;;AAEA;AACA;AACA;AACA,2CAA2C,gFAAgF;AAC3H,8BAA8B,8DAA8D;AAC5F,mCAAmC,uEAAuE;AAC1G;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,iEAAiE;AACjE;AACA,yEAAyE;AACzE,sCAAsC;AACtC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;ACrDD;AAAe;AACf;AACA;AACA,CAAC;;;;;;;;;;;;;ACHD;AAAe;AACf,uBAAuB;AACvB,0BAA0B;AAC1B,wBAAwB;AACxB;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA,mEAAmE,gCAAgC,EAAE;AACrG;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,kCAAkC,EAAE;AACjE;AACA;AACA;;AAEA;AACA;AACA,4BAA4B,wDAAwD,EAAE;;AAEtF;AACA,CAAC;;;;;;;;;;;;;ACxED;AAAA;AAAkC;;AAEnB;AACf,gCAAgC,iDAAQ;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;AClBD;AAAA;AAAkC;;AAEnB;AACf,gCAAgC,iDAAQ;AACxC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;;;;;;;;;;;;ACtBW;;AAEZ;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA,C;;;;;;;;;;;;AChCY;;AAEZ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;;;;;;;;;;;;;AChBA;AACA;AACA;AACA;;IAEqBA,G;;;AAEnB,eAAYC,MAAZ,EAAoBC,OAApB,EAA6B;AAAA;;AAC3B,QAAI,CAACD,MAAD,IAAW,CAACA,MAAM,CAACE,UAAvB,EAAmC;AACjC,YAAM,IAAIC,KAAJ,C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","file":"LightningMaps.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"LightningMaps\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"LightningMaps\"] = factory();\n\telse\n\t\troot[\"LightningMaps\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","\"use strict\"\n\nvar twoProduct = require(\"two-product\")\nvar robustSum = require(\"robust-sum\")\nvar robustScale = require(\"robust-scale\")\nvar robustSubtract = require(\"robust-subtract\")\n\nvar NUM_EXPAND = 5\n\nvar EPSILON     = 1.1102230246251565e-16\nvar ERRBOUND3   = (3.0 + 16.0 * EPSILON) * EPSILON\nvar ERRBOUND4   = (7.0 + 56.0 * EPSILON) * EPSILON\n\nfunction cofactor(m, c) {\n  var result = new Array(m.length-1)\n  for(var i=1; i<m.length; ++i) {\n    var r = result[i-1] = new Array(m.length-1)\n    for(var j=0,k=0; j<m.length; ++j) {\n      if(j === c) {\n        continue\n      }\n      r[k++] = m[i][j]\n    }\n  }\n  return result\n}\n\nfunction matrix(n) {\n  var result = new Array(n)\n  for(var i=0; i<n; ++i) {\n    result[i] = new Array(n)\n    for(var j=0; j<n; ++j) {\n      result[i][j] = [\"m\", j, \"[\", (n-i-1), \"]\"].join(\"\")\n    }\n  }\n  return result\n}\n\nfunction sign(n) {\n  if(n & 1) {\n    return \"-\"\n  }\n  return \"\"\n}\n\nfunction generateSum(expr) {\n  if(expr.length === 1) {\n    return expr[0]\n  } else if(expr.length === 2) {\n    return [\"sum(\", expr[0], \",\", expr[1], \")\"].join(\"\")\n  } else {\n    var m = expr.length>>1\n    return [\"sum(\", generateSum(expr.slice(0, m)), \",\", generateSum(expr.slice(m)), \")\"].join(\"\")\n  }\n}\n\nfunction determinant(m) {\n  if(m.length === 2) {\n    return [[\"sum(prod(\", m[0][0], \",\", m[1][1], \"),prod(-\", m[0][1], \",\", m[1][0], \"))\"].join(\"\")]\n  } else {\n    var expr = []\n    for(var i=0; i<m.length; ++i) {\n      expr.push([\"scale(\", generateSum(determinant(cofactor(m, i))), \",\", sign(i), m[0][i], \")\"].join(\"\"))\n    }\n    return expr\n  }\n}\n\nfunction orientation(n) {\n  var pos = []\n  var neg = []\n  var m = matrix(n)\n  var args = []\n  for(var i=0; i<n; ++i) {\n    if((i&1)===0) {\n      pos.push.apply(pos, determinant(cofactor(m, i)))\n    } else {\n      neg.push.apply(neg, determinant(cofactor(m, i)))\n    }\n    args.push(\"m\" + i)\n  }\n  var posExpr = generateSum(pos)\n  var negExpr = generateSum(neg)\n  var funcName = \"orientation\" + n + \"Exact\"\n  var code = [\"function \", funcName, \"(\", args.join(), \"){var p=\", posExpr, \",n=\", negExpr, \",d=sub(p,n);\\\nreturn d[d.length-1];};return \", funcName].join(\"\")\n  var proc = new Function(\"sum\", \"prod\", \"scale\", \"sub\", code)\n  return proc(robustSum, twoProduct, robustScale, robustSubtract)\n}\n\nvar orientation3Exact = orientation(3)\nvar orientation4Exact = orientation(4)\n\nvar CACHED = [\n  function orientation0() { return 0 },\n  function orientation1() { return 0 },\n  function orientation2(a, b) { \n    return b[0] - a[0]\n  },\n  function orientation3(a, b, c) {\n    var l = (a[1] - c[1]) * (b[0] - c[0])\n    var r = (a[0] - c[0]) * (b[1] - c[1])\n    var det = l - r\n    var s\n    if(l > 0) {\n      if(r <= 0) {\n        return det\n      } else {\n        s = l + r\n      }\n    } else if(l < 0) {\n      if(r >= 0) {\n        return det\n      } else {\n        s = -(l + r)\n      }\n    } else {\n      return det\n    }\n    var tol = ERRBOUND3 * s\n    if(det >= tol || det <= -tol) {\n      return det\n    }\n    return orientation3Exact(a, b, c)\n  },\n  function orientation4(a,b,c,d) {\n    var adx = a[0] - d[0]\n    var bdx = b[0] - d[0]\n    var cdx = c[0] - d[0]\n    var ady = a[1] - d[1]\n    var bdy = b[1] - d[1]\n    var cdy = c[1] - d[1]\n    var adz = a[2] - d[2]\n    var bdz = b[2] - d[2]\n    var cdz = c[2] - d[2]\n    var bdxcdy = bdx * cdy\n    var cdxbdy = cdx * bdy\n    var cdxady = cdx * ady\n    var adxcdy = adx * cdy\n    var adxbdy = adx * bdy\n    var bdxady = bdx * ady\n    var det = adz * (bdxcdy - cdxbdy) \n            + bdz * (cdxady - adxcdy)\n            + cdz * (adxbdy - bdxady)\n    var permanent = (Math.abs(bdxcdy) + Math.abs(cdxbdy)) * Math.abs(adz)\n                  + (Math.abs(cdxady) + Math.abs(adxcdy)) * Math.abs(bdz)\n                  + (Math.abs(adxbdy) + Math.abs(bdxady)) * Math.abs(cdz)\n    var tol = ERRBOUND4 * permanent\n    if ((det > tol) || (-det > tol)) {\n      return det\n    }\n    return orientation4Exact(a,b,c,d)\n  }\n]\n\nfunction slowOrient(args) {\n  var proc = CACHED[args.length]\n  if(!proc) {\n    proc = CACHED[args.length] = orientation(args.length)\n  }\n  return proc.apply(undefined, args)\n}\n\nfunction generateOrientationProc() {\n  while(CACHED.length <= NUM_EXPAND) {\n    CACHED.push(orientation(CACHED.length))\n  }\n  var args = []\n  var procArgs = [\"slow\"]\n  for(var i=0; i<=NUM_EXPAND; ++i) {\n    args.push(\"a\" + i)\n    procArgs.push(\"o\" + i)\n  }\n  var code = [\n    \"function getOrientation(\", args.join(), \"){switch(arguments.length){case 0:case 1:return 0;\"\n  ]\n  for(var i=2; i<=NUM_EXPAND; ++i) {\n    code.push(\"case \", i, \":return o\", i, \"(\", args.slice(0, i).join(), \");\")\n  }\n  code.push(\"}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation\")\n  procArgs.push(code.join(\"\"))\n\n  var proc = Function.apply(undefined, procArgs)\n  module.exports = proc.apply(undefined, [slowOrient].concat(CACHED))\n  for(var i=0; i<=NUM_EXPAND; ++i) {\n    module.exports[i] = CACHED[i]\n  }\n}\n\ngenerateOrientationProc()","module.exports = robustPointInPolygon\n\nvar orient = require('robust-orientation')\n\nfunction robustPointInPolygon(vs, point) {\n  var x = point[0]\n  var y = point[1]\n  var n = vs.length\n  var inside = 1\n  var lim = n\n  for(var i = 0, j = n-1; i<lim; j=i++) {\n    var a = vs[i]\n    var b = vs[j]\n    var yi = a[1]\n    var yj = b[1]\n    if(yj < yi) {\n      if(yj < y && y < yi) {\n        var s = orient(a, b, point)\n        if(s === 0) {\n          return 0\n        } else {\n          inside ^= (0 < s)|0\n        }\n      } else if(y === yi) {\n        var c = vs[(i+1)%n]\n        var yk = c[1]\n        if(yi < yk) {\n          var s = orient(a, b, point)\n          if(s === 0) {\n            return 0\n          } else {\n            inside ^= (0 < s)|0\n          }\n        }\n      }\n    } else if(yi < yj) {\n      if(yi < y && y < yj) {\n        var s = orient(a, b, point)\n        if(s === 0) {\n          return 0\n        } else {\n          inside ^= (s < 0)|0\n        }\n      } else if(y === yi) {\n        var c = vs[(i+1)%n]\n        var yk = c[1]\n        if(yk < yi) {\n          var s = orient(a, b, point)\n          if(s === 0) {\n            return 0\n          } else {\n            inside ^= (s < 0)|0\n          }\n        }\n      }\n    } else if(y === yi) {\n      var x0 = Math.min(a[0], b[0])\n      var x1 = Math.max(a[0], b[0])\n      if(i === 0) {\n        while(j>0) {\n          var k = (j+n-1)%n\n          var p = vs[k]\n          if(p[1] !== y) {\n            break\n          }\n          var px = p[0]\n          x0 = Math.min(x0, px)\n          x1 = Math.max(x1, px)\n          j = k\n        }\n        if(j === 0) {\n          if(x0 <= x && x <= x1) {\n            return 0\n          }\n          return 1 \n        }\n        lim = j+1\n      }\n      var y0 = vs[(j+n-1)%n][1]\n      while(i+1<lim) {\n        var p = vs[i+1]\n        if(p[1] !== y) {\n          break\n        }\n        var px = p[0]\n        x0 = Math.min(x0, px)\n        x1 = Math.max(x1, px)\n        i += 1\n      }\n      if(x0 <= x && x <= x1) {\n        return 0\n      }\n      var y1 = vs[(i+1)%n][1]\n      if(x < x0 && (y0 < y !== y1 < y)) {\n        inside ^= 1\n      }\n    }\n  }\n  return 2 * inside - 1\n}","\"use strict\"\n\nvar twoProduct = require(\"two-product\")\nvar twoSum = require(\"two-sum\")\n\nmodule.exports = scaleLinearExpansion\n\nfunction scaleLinearExpansion(e, scale) {\n  var n = e.length\n  if(n === 1) {\n    var ts = twoProduct(e[0], scale)\n    if(ts[0]) {\n      return ts\n    }\n    return [ ts[1] ]\n  }\n  var g = new Array(2 * n)\n  var q = [0.1, 0.1]\n  var t = [0.1, 0.1]\n  var count = 0\n  twoProduct(e[0], scale, q)\n  if(q[0]) {\n    g[count++] = q[0]\n  }\n  for(var i=1; i<n; ++i) {\n    twoProduct(e[i], scale, t)\n    var pq = q[1]\n    twoSum(pq, t[0], q)\n    if(q[0]) {\n      g[count++] = q[0]\n    }\n    var a = t[1]\n    var b = q[1]\n    var x = a + b\n    var bv = x - a\n    var y = b - bv\n    q[1] = x\n    if(y) {\n      g[count++] = y\n    }\n  }\n  if(q[1]) {\n    g[count++] = q[1]\n  }\n  if(count === 0) {\n    g[count++] = 0.0\n  }\n  g.length = count\n  return g\n}","\"use strict\"\n\nmodule.exports = robustSubtract\n\n//Easy case: Add two scalars\nfunction scalarScalar(a, b) {\n  var x = a + b\n  var bv = x - a\n  var av = x - bv\n  var br = b - bv\n  var ar = a - av\n  var y = ar + br\n  if(y) {\n    return [y, x]\n  }\n  return [x]\n}\n\nfunction robustSubtract(e, f) {\n  var ne = e.length|0\n  var nf = f.length|0\n  if(ne === 1 && nf === 1) {\n    return scalarScalar(e[0], -f[0])\n  }\n  var n = ne + nf\n  var g = new Array(n)\n  var count = 0\n  var eptr = 0\n  var fptr = 0\n  var abs = Math.abs\n  var ei = e[eptr]\n  var ea = abs(ei)\n  var fi = -f[fptr]\n  var fa = abs(fi)\n  var a, b\n  if(ea < fa) {\n    b = ei\n    eptr += 1\n    if(eptr < ne) {\n      ei = e[eptr]\n      ea = abs(ei)\n    }\n  } else {\n    b = fi\n    fptr += 1\n    if(fptr < nf) {\n      fi = -f[fptr]\n      fa = abs(fi)\n    }\n  }\n  if((eptr < ne && ea < fa) || (fptr >= nf)) {\n    a = ei\n    eptr += 1\n    if(eptr < ne) {\n      ei = e[eptr]\n      ea = abs(ei)\n    }\n  } else {\n    a = fi\n    fptr += 1\n    if(fptr < nf) {\n      fi = -f[fptr]\n      fa = abs(fi)\n    }\n  }\n  var x = a + b\n  var bv = x - a\n  var y = b - bv\n  var q0 = y\n  var q1 = x\n  var _x, _bv, _av, _br, _ar\n  while(eptr < ne && fptr < nf) {\n    if(ea < fa) {\n      a = ei\n      eptr += 1\n      if(eptr < ne) {\n        ei = e[eptr]\n        ea = abs(ei)\n      }\n    } else {\n      a = fi\n      fptr += 1\n      if(fptr < nf) {\n        fi = -f[fptr]\n        fa = abs(fi)\n      }\n    }\n    b = q0\n    x = a + b\n    bv = x - a\n    y = b - bv\n    if(y) {\n      g[count++] = y\n    }\n    _x = q1 + x\n    _bv = _x - q1\n    _av = _x - _bv\n    _br = x - _bv\n    _ar = q1 - _av\n    q0 = _ar + _br\n    q1 = _x\n  }\n  while(eptr < ne) {\n    a = ei\n    b = q0\n    x = a + b\n    bv = x - a\n    y = b - bv\n    if(y) {\n      g[count++] = y\n    }\n    _x = q1 + x\n    _bv = _x - q1\n    _av = _x - _bv\n    _br = x - _bv\n    _ar = q1 - _av\n    q0 = _ar + _br\n    q1 = _x\n    eptr += 1\n    if(eptr < ne) {\n      ei = e[eptr]\n    }\n  }\n  while(fptr < nf) {\n    a = fi\n    b = q0\n    x = a + b\n    bv = x - a\n    y = b - bv\n    if(y) {\n      g[count++] = y\n    } \n    _x = q1 + x\n    _bv = _x - q1\n    _av = _x - _bv\n    _br = x - _bv\n    _ar = q1 - _av\n    q0 = _ar + _br\n    q1 = _x\n    fptr += 1\n    if(fptr < nf) {\n      fi = -f[fptr]\n    }\n  }\n  if(q0) {\n    g[count++] = q0\n  }\n  if(q1) {\n    g[count++] = q1\n  }\n  if(!count) {\n    g[count++] = 0.0  \n  }\n  g.length = count\n  return g\n}","\"use strict\"\n\nmodule.exports = linearExpansionSum\n\n//Easy case: Add two scalars\nfunction scalarScalar(a, b) {\n  var x = a + b\n  var bv = x - a\n  var av = x - bv\n  var br = b - bv\n  var ar = a - av\n  var y = ar + br\n  if(y) {\n    return [y, x]\n  }\n  return [x]\n}\n\nfunction linearExpansionSum(e, f) {\n  var ne = e.length|0\n  var nf = f.length|0\n  if(ne === 1 && nf === 1) {\n    return scalarScalar(e[0], f[0])\n  }\n  var n = ne + nf\n  var g = new Array(n)\n  var count = 0\n  var eptr = 0\n  var fptr = 0\n  var abs = Math.abs\n  var ei = e[eptr]\n  var ea = abs(ei)\n  var fi = f[fptr]\n  var fa = abs(fi)\n  var a, b\n  if(ea < fa) {\n    b = ei\n    eptr += 1\n    if(eptr < ne) {\n      ei = e[eptr]\n      ea = abs(ei)\n    }\n  } else {\n    b = fi\n    fptr += 1\n    if(fptr < nf) {\n      fi = f[fptr]\n      fa = abs(fi)\n    }\n  }\n  if((eptr < ne && ea < fa) || (fptr >= nf)) {\n    a = ei\n    eptr += 1\n    if(eptr < ne) {\n      ei = e[eptr]\n      ea = abs(ei)\n    }\n  } else {\n    a = fi\n    fptr += 1\n    if(fptr < nf) {\n      fi = f[fptr]\n      fa = abs(fi)\n    }\n  }\n  var x = a + b\n  var bv = x - a\n  var y = b - bv\n  var q0 = y\n  var q1 = x\n  var _x, _bv, _av, _br, _ar\n  while(eptr < ne && fptr < nf) {\n    if(ea < fa) {\n      a = ei\n      eptr += 1\n      if(eptr < ne) {\n        ei = e[eptr]\n        ea = abs(ei)\n      }\n    } else {\n      a = fi\n      fptr += 1\n      if(fptr < nf) {\n        fi = f[fptr]\n        fa = abs(fi)\n      }\n    }\n    b = q0\n    x = a + b\n    bv = x - a\n    y = b - bv\n    if(y) {\n      g[count++] = y\n    }\n    _x = q1 + x\n    _bv = _x - q1\n    _av = _x - _bv\n    _br = x - _bv\n    _ar = q1 - _av\n    q0 = _ar + _br\n    q1 = _x\n  }\n  while(eptr < ne) {\n    a = ei\n    b = q0\n    x = a + b\n    bv = x - a\n    y = b - bv\n    if(y) {\n      g[count++] = y\n    }\n    _x = q1 + x\n    _bv = _x - q1\n    _av = _x - _bv\n    _br = x - _bv\n    _ar = q1 - _av\n    q0 = _ar + _br\n    q1 = _x\n    eptr += 1\n    if(eptr < ne) {\n      ei = e[eptr]\n    }\n  }\n  while(fptr < nf) {\n    a = fi\n    b = q0\n    x = a + b\n    bv = x - a\n    y = b - bv\n    if(y) {\n      g[count++] = y\n    } \n    _x = q1 + x\n    _bv = _x - q1\n    _av = _x - _bv\n    _br = x - _bv\n    _ar = q1 - _av\n    q0 = _ar + _br\n    q1 = _x\n    fptr += 1\n    if(fptr < nf) {\n      fi = f[fptr]\n    }\n  }\n  if(q0) {\n    g[count++] = q0\n  }\n  if(q1) {\n    g[count++] = q1\n  }\n  if(!count) {\n    g[count++] = 0.0  \n  }\n  g.length = count\n  return g\n}","export {default as bbox} from \"./src/bbox\";\nexport {default as feature} from \"./src/feature\";\nexport {default as mesh, meshArcs} from \"./src/mesh\";\nexport {default as merge, mergeArcs} from \"./src/merge\";\nexport {default as neighbors} from \"./src/neighbors\";\nexport {default as quantize} from \"./src/quantize\";\nexport {default as transform} from \"./src/transform\";\nexport {default as untransform} from \"./src/untransform\";\n","import transform from \"./transform\";\n\nexport default function(topology) {\n  var t = transform(topology.transform), key,\n      x0 = Infinity, y0 = x0, x1 = -x0, y1 = -x0;\n\n  function bboxPoint(p) {\n    p = t(p);\n    if (p[0] < x0) x0 = p[0];\n    if (p[0] > x1) x1 = p[0];\n    if (p[1] < y0) y0 = p[1];\n    if (p[1] > y1) y1 = p[1];\n  }\n\n  function bboxGeometry(o) {\n    switch (o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(bboxGeometry); break;\n      case \"Point\": bboxPoint(o.coordinates); break;\n      case \"MultiPoint\": o.coordinates.forEach(bboxPoint); break;\n    }\n  }\n\n  topology.arcs.forEach(function(arc) {\n    var i = -1, n = arc.length, p;\n    while (++i < n) {\n      p = t(arc[i], i);\n      if (p[0] < x0) x0 = p[0];\n      if (p[0] > x1) x1 = p[0];\n      if (p[1] < y0) y0 = p[1];\n      if (p[1] > y1) y1 = p[1];\n    }\n  });\n\n  for (key in topology.objects) {\n    bboxGeometry(topology.objects[key]);\n  }\n\n  return [x0, y0, x1, y1];\n}\n","export default function(a, x) {\n  var lo = 0, hi = a.length;\n  while (lo < hi) {\n    var mid = lo + hi >>> 1;\n    if (a[mid] < x) lo = mid + 1;\n    else hi = mid;\n  }\n  return lo;\n}\n","import reverse from \"./reverse\";\nimport transform from \"./transform\";\n\nexport default function(topology, o) {\n  return o.type === \"GeometryCollection\"\n      ? {type: \"FeatureCollection\", features: o.geometries.map(function(o) { return feature(topology, o); })}\n      : feature(topology, o);\n}\n\nexport function feature(topology, o) {\n  var id = o.id,\n      bbox = o.bbox,\n      properties = o.properties == null ? {} : o.properties,\n      geometry = object(topology, o);\n  return id == null && bbox == null ? {type: \"Feature\", properties: properties, geometry: geometry}\n      : bbox == null ? {type: \"Feature\", id: id, properties: properties, geometry: geometry}\n      : {type: \"Feature\", id: id, bbox: bbox, properties: properties, geometry: geometry};\n}\n\nexport function object(topology, o) {\n  var transformPoint = transform(topology.transform),\n      arcs = topology.arcs;\n\n  function arc(i, points) {\n    if (points.length) points.pop();\n    for (var a = arcs[i < 0 ? ~i : i], k = 0, n = a.length; k < n; ++k) {\n      points.push(transformPoint(a[k], k));\n    }\n    if (i < 0) reverse(points, n);\n  }\n\n  function point(p) {\n    return transformPoint(p);\n  }\n\n  function line(arcs) {\n    var points = [];\n    for (var i = 0, n = arcs.length; i < n; ++i) arc(arcs[i], points);\n    if (points.length < 2) points.push(points[0]); // This should never happen per the specification.\n    return points;\n  }\n\n  function ring(arcs) {\n    var points = line(arcs);\n    while (points.length < 4) points.push(points[0]); // This may happen if an arc has only two points.\n    return points;\n  }\n\n  function polygon(arcs) {\n    return arcs.map(ring);\n  }\n\n  function geometry(o) {\n    var type = o.type, coordinates;\n    switch (type) {\n      case \"GeometryCollection\": return {type: type, geometries: o.geometries.map(geometry)};\n      case \"Point\": coordinates = point(o.coordinates); break;\n      case \"MultiPoint\": coordinates = o.coordinates.map(point); break;\n      case \"LineString\": coordinates = line(o.arcs); break;\n      case \"MultiLineString\": coordinates = o.arcs.map(line); break;\n      case \"Polygon\": coordinates = polygon(o.arcs); break;\n      case \"MultiPolygon\": coordinates = o.arcs.map(polygon); break;\n      default: return null;\n    }\n    return {type: type, coordinates: coordinates};\n  }\n\n  return geometry(o);\n}\n","export default function(x) {\n  return x;\n}\n","import {object} from \"./feature\";\nimport stitch from \"./stitch\";\n\nfunction planarRingArea(ring) {\n  var i = -1, n = ring.length, a, b = ring[n - 1], area = 0;\n  while (++i < n) a = b, b = ring[i], area += a[0] * b[1] - a[1] * b[0];\n  return Math.abs(area); // Note: doubled area!\n}\n\nexport default function(topology) {\n  return object(topology, mergeArcs.apply(this, arguments));\n}\n\nexport function mergeArcs(topology, objects) {\n  var polygonsByArc = {},\n      polygons = [],\n      groups = [];\n\n  objects.forEach(geometry);\n\n  function geometry(o) {\n    switch (o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\n      case \"Polygon\": extract(o.arcs); break;\n      case \"MultiPolygon\": o.arcs.forEach(extract); break;\n    }\n  }\n\n  function extract(polygon) {\n    polygon.forEach(function(ring) {\n      ring.forEach(function(arc) {\n        (polygonsByArc[arc = arc < 0 ? ~arc : arc] || (polygonsByArc[arc] = [])).push(polygon);\n      });\n    });\n    polygons.push(polygon);\n  }\n\n  function area(ring) {\n    return planarRingArea(object(topology, {type: \"Polygon\", arcs: [ring]}).coordinates[0]);\n  }\n\n  polygons.forEach(function(polygon) {\n    if (!polygon._) {\n      var group = [],\n          neighbors = [polygon];\n      polygon._ = 1;\n      groups.push(group);\n      while (polygon = neighbors.pop()) {\n        group.push(polygon);\n        polygon.forEach(function(ring) {\n          ring.forEach(function(arc) {\n            polygonsByArc[arc < 0 ? ~arc : arc].forEach(function(polygon) {\n              if (!polygon._) {\n                polygon._ = 1;\n                neighbors.push(polygon);\n              }\n            });\n          });\n        });\n      }\n    }\n  });\n\n  polygons.forEach(function(polygon) {\n    delete polygon._;\n  });\n\n  return {\n    type: \"MultiPolygon\",\n    arcs: groups.map(function(polygons) {\n      var arcs = [], n;\n\n      // Extract the exterior (unique) arcs.\n      polygons.forEach(function(polygon) {\n        polygon.forEach(function(ring) {\n          ring.forEach(function(arc) {\n            if (polygonsByArc[arc < 0 ? ~arc : arc].length < 2) {\n              arcs.push(arc);\n            }\n          });\n        });\n      });\n\n      // Stitch the arcs into one or more rings.\n      arcs = stitch(topology, arcs);\n\n      // If more than one ring is returned,\n      // at most one of these rings can be the exterior;\n      // choose the one with the greatest absolute area.\n      if ((n = arcs.length) > 1) {\n        for (var i = 1, k = area(arcs[0]), ki, t; i < n; ++i) {\n          if ((ki = area(arcs[i])) > k) {\n            t = arcs[0], arcs[0] = arcs[i], arcs[i] = t, k = ki;\n          }\n        }\n      }\n\n      return arcs;\n    })\n  };\n}\n","import {object} from \"./feature\";\nimport stitch from \"./stitch\";\n\nexport default function(topology) {\n  return object(topology, meshArcs.apply(this, arguments));\n}\n\nexport function meshArcs(topology, object, filter) {\n  var arcs, i, n;\n  if (arguments.length > 1) arcs = extractArcs(topology, object, filter);\n  else for (i = 0, arcs = new Array(n = topology.arcs.length); i < n; ++i) arcs[i] = i;\n  return {type: \"MultiLineString\", arcs: stitch(topology, arcs)};\n}\n\nfunction extractArcs(topology, object, filter) {\n  var arcs = [],\n      geomsByArc = [],\n      geom;\n\n  function extract0(i) {\n    var j = i < 0 ? ~i : i;\n    (geomsByArc[j] || (geomsByArc[j] = [])).push({i: i, g: geom});\n  }\n\n  function extract1(arcs) {\n    arcs.forEach(extract0);\n  }\n\n  function extract2(arcs) {\n    arcs.forEach(extract1);\n  }\n\n  function extract3(arcs) {\n    arcs.forEach(extract2);\n  }\n\n  function geometry(o) {\n    switch (geom = o, o.type) {\n      case \"GeometryCollection\": o.geometries.forEach(geometry); break;\n      case \"LineString\": extract1(o.arcs); break;\n      case \"MultiLineString\": case \"Polygon\": extract2(o.arcs); break;\n      case \"MultiPolygon\": extract3(o.arcs); break;\n    }\n  }\n\n  geometry(object);\n\n  geomsByArc.forEach(filter == null\n      ? function(geoms) { arcs.push(geoms[0].i); }\n      : function(geoms) { if (filter(geoms[0].g, geoms[geoms.length - 1].g)) arcs.push(geoms[0].i); });\n\n  return arcs;\n}\n","import bisect from \"./bisect\";\n\nexport default function(objects) {\n  var indexesByArc = {}, // arc index -> array of object indexes\n      neighbors = objects.map(function() { return []; });\n\n  function line(arcs, i) {\n    arcs.forEach(function(a) {\n      if (a < 0) a = ~a;\n      var o = indexesByArc[a];\n      if (o) o.push(i);\n      else indexesByArc[a] = [i];\n    });\n  }\n\n  function polygon(arcs, i) {\n    arcs.forEach(function(arc) { line(arc, i); });\n  }\n\n  function geometry(o, i) {\n    if (o.type === \"GeometryCollection\") o.geometries.forEach(function(o) { geometry(o, i); });\n    else if (o.type in geometryType) geometryType[o.type](o.arcs, i);\n  }\n\n  var geometryType = {\n    LineString: line,\n    MultiLineString: polygon,\n    Polygon: polygon,\n    MultiPolygon: function(arcs, i) { arcs.forEach(function(arc) { polygon(arc, i); }); }\n  };\n\n  objects.forEach(geometry);\n\n  for (var i in indexesByArc) {\n    for (var indexes = indexesByArc[i], m = indexes.length, j = 0; j < m; ++j) {\n      for (var k = j + 1; k < m; ++k) {\n        var ij = indexes[j], ik = indexes[k], n;\n        if ((n = neighbors[ij])[i = bisect(n, ik)] !== ik) n.splice(i, 0, ik);\n        if ((n = neighbors[ik])[i = bisect(n, ij)] !== ij) n.splice(i, 0, ij);\n      }\n    }\n  }\n\n  return neighbors;\n}\n","import bbox from \"./bbox\";\nimport untransform from \"./untransform\";\n\nexport default function(topology, transform) {\n  if (topology.transform) throw new Error(\"already quantized\");\n\n  if (!transform || !transform.scale) {\n    if (!((n = Math.floor(transform)) >= 2)) throw new Error(\"n must be 2\");\n    box = topology.bbox || bbox(topology);\n    var x0 = box[0], y0 = box[1], x1 = box[2], y1 = box[3], n;\n    transform = {scale: [x1 - x0 ? (x1 - x0) / (n - 1) : 1, y1 - y0 ? (y1 - y0) / (n - 1) : 1], translate: [x0, y0]};\n  } else {\n    box = topology.bbox;\n  }\n\n  var t = untransform(transform), box, key, inputs = topology.objects, outputs = {};\n\n  function quantizePoint(point) {\n    return t(point);\n  }\n\n  function quantizeGeometry(input) {\n    var output;\n    switch (input.type) {\n      case \"GeometryCollection\": output = {type: \"GeometryCollection\", geometries: input.geometries.map(quantizeGeometry)}; break;\n      case \"Point\": output = {type: \"Point\", coordinates: quantizePoint(input.coordinates)}; break;\n      case \"MultiPoint\": output = {type: \"MultiPoint\", coordinates: input.coordinates.map(quantizePoint)}; break;\n      default: return input;\n    }\n    if (input.id != null) output.id = input.id;\n    if (input.bbox != null) output.bbox = input.bbox;\n    if (input.properties != null) output.properties = input.properties;\n    return output;\n  }\n\n  function quantizeArc(input) {\n    var i = 0, j = 1, n = input.length, p, output = new Array(n); // pessimistic\n    output[0] = t(input[0], 0);\n    while (++i < n) if ((p = t(input[i], i))[0] || p[1]) output[j++] = p; // non-coincident points\n    if (j === 1) output[j++] = [0, 0]; // an arc must have at least two points\n    output.length = j;\n    return output;\n  }\n\n  for (key in inputs) outputs[key] = quantizeGeometry(inputs[key]);\n\n  return {\n    type: \"Topology\",\n    bbox: box,\n    transform: transform,\n    objects: outputs,\n    arcs: topology.arcs.map(quantizeArc)\n  };\n}\n","export default function(array, n) {\n  var t, j = array.length, i = j - n;\n  while (i < --j) t = array[i], array[i++] = array[j], array[j] = t;\n}\n","export default function(topology, arcs) {\n  var stitchedArcs = {},\n      fragmentByStart = {},\n      fragmentByEnd = {},\n      fragments = [],\n      emptyIndex = -1;\n\n  // Stitch empty arcs first, since they may be subsumed by other arcs.\n  arcs.forEach(function(i, j) {\n    var arc = topology.arcs[i < 0 ? ~i : i], t;\n    if (arc.length < 3 && !arc[1][0] && !arc[1][1]) {\n      t = arcs[++emptyIndex], arcs[emptyIndex] = i, arcs[j] = t;\n    }\n  });\n\n  arcs.forEach(function(i) {\n    var e = ends(i),\n        start = e[0],\n        end = e[1],\n        f, g;\n\n    if (f = fragmentByEnd[start]) {\n      delete fragmentByEnd[f.end];\n      f.push(i);\n      f.end = end;\n      if (g = fragmentByStart[end]) {\n        delete fragmentByStart[g.start];\n        var fg = g === f ? f : f.concat(g);\n        fragmentByStart[fg.start = f.start] = fragmentByEnd[fg.end = g.end] = fg;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else if (f = fragmentByStart[end]) {\n      delete fragmentByStart[f.start];\n      f.unshift(i);\n      f.start = start;\n      if (g = fragmentByEnd[start]) {\n        delete fragmentByEnd[g.end];\n        var gf = g === f ? f : g.concat(f);\n        fragmentByStart[gf.start = g.start] = fragmentByEnd[gf.end = f.end] = gf;\n      } else {\n        fragmentByStart[f.start] = fragmentByEnd[f.end] = f;\n      }\n    } else {\n      f = [i];\n      fragmentByStart[f.start = start] = fragmentByEnd[f.end = end] = f;\n    }\n  });\n\n  function ends(i) {\n    var arc = topology.arcs[i < 0 ? ~i : i], p0 = arc[0], p1;\n    if (topology.transform) p1 = [0, 0], arc.forEach(function(dp) { p1[0] += dp[0], p1[1] += dp[1]; });\n    else p1 = arc[arc.length - 1];\n    return i < 0 ? [p1, p0] : [p0, p1];\n  }\n\n  function flush(fragmentByEnd, fragmentByStart) {\n    for (var k in fragmentByEnd) {\n      var f = fragmentByEnd[k];\n      delete fragmentByStart[f.start];\n      delete f.start;\n      delete f.end;\n      f.forEach(function(i) { stitchedArcs[i < 0 ? ~i : i] = 1; });\n      fragments.push(f);\n    }\n  }\n\n  flush(fragmentByEnd, fragmentByStart);\n  flush(fragmentByStart, fragmentByEnd);\n  arcs.forEach(function(i) { if (!stitchedArcs[i < 0 ? ~i : i]) fragments.push([i]); });\n\n  return fragments;\n}\n","import identity from \"./identity\";\n\nexport default function(transform) {\n  if (transform == null) return identity;\n  var x0,\n      y0,\n      kx = transform.scale[0],\n      ky = transform.scale[1],\n      dx = transform.translate[0],\n      dy = transform.translate[1];\n  return function(input, i) {\n    if (!i) x0 = y0 = 0;\n    var j = 2, n = input.length, output = new Array(n);\n    output[0] = (x0 += input[0]) * kx + dx;\n    output[1] = (y0 += input[1]) * ky + dy;\n    while (j < n) output[j] = input[j], ++j;\n    return output;\n  };\n}\n","import identity from \"./identity\";\n\nexport default function(transform) {\n  if (transform == null) return identity;\n  var x0,\n      y0,\n      kx = transform.scale[0],\n      ky = transform.scale[1],\n      dx = transform.translate[0],\n      dy = transform.translate[1];\n  return function(input, i) {\n    if (!i) x0 = y0 = 0;\n    var j = 2,\n        n = input.length,\n        output = new Array(n),\n        x1 = Math.round((input[0] - dx) / kx),\n        y1 = Math.round((input[1] - dy) / ky);\n    output[0] = x1 - x0, x0 = x1;\n    output[1] = y1 - y0, y0 = y1;\n    while (j < n) output[j] = input[j], ++j;\n    return output;\n  };\n}\n","\"use strict\"\n\nmodule.exports = twoProduct\n\nvar SPLITTER = +(Math.pow(2, 27) + 1.0)\n\nfunction twoProduct(a, b, result) {\n  var x = a * b\n\n  var c = SPLITTER * a\n  var abig = c - a\n  var ahi = c - abig\n  var alo = a - ahi\n\n  var d = SPLITTER * b\n  var bbig = d - b\n  var bhi = d - bbig\n  var blo = b - bhi\n\n  var err1 = x - (ahi * bhi)\n  var err2 = err1 - (alo * bhi)\n  var err3 = err2 - (ahi * blo)\n\n  var y = alo * blo - err3\n\n  if(result) {\n    result[0] = y\n    result[1] = x\n    return result\n  }\n\n  return [ y, x ]\n}","\"use strict\"\n\nmodule.exports = fastTwoSum\n\nfunction fastTwoSum(a, b, result) {\n\tvar x = a + b\n\tvar bv = x - a\n\tvar av = x - bv\n\tvar br = b - bv\n\tvar ar = a - av\n\tif(result) {\n\t\tresult[0] = ar + br\n\t\tresult[1] = x\n\t\treturn result\n\t}\n\treturn [ar+br, x]\n}","import TileConversion from './TileConversion';\nimport TileLayer from './TileLayer';\nimport MapState from './MapState';\nimport { defaultMapOptions } from './defaultOptions';\n\nexport default class Map {\n\n  constructor(canvas, options) {\n    if (!canvas || !canvas.getContext) {\n      throw new Error('Could not get canvas context');\n    }\n\n    this.canvas = canvas;\n    this.context = this.canvas.getContext('2d');\n\n    this.options = Object.assign({}, defaultMapOptions, options);\n\n    this.initializeState();\n    this.attachEvents();\n\n    this.lastDrawState = null;\n\n    /**\n     * Events\n     */\n    this.onMarkerClicked = null;\n    this.onMarkerHover = null;\n    this.onPolygonHover = null;\n\n    this.draw = this.draw.bind(this);\n    window.requestAnimationFrame(this.draw);\n  }\n\n  initializeState() {\n    this.state = {\n      canvasDimensions: [this.canvas.width, this.canvas.height],\n      tiles: {},\n      moveOffset: [0, 0],\n      targetMoveOffset: [0, 0],\n      targetMoveOffsetIsCoord: false,\n      moveAnimationStart: null,\n      dragStartPosition: null,\n      lastZoomEventActionTime: null,\n      startZoom: this.options.zoom,\n      targetZoom: this.options.zoom,\n      zoomAnimationStart: null,\n      scale: 1,\n      lastMouseMoveEvent: null,\n      mouseVelocities: [],\n      markers: [],\n      polygons: [],\n      tileLayers: [\n        new TileLayer(this)\n      ],\n      mousePosition: { x: 0, y: 0},\n      forceRedraw: false\n    };\n  }\n\n  getZoom() {\n    return this.options.zoom;\n  }\n\n  setZoom(zoom) {\n    if (this.zoomValueIsValid(zoom) && this.isReadyForZoomEvent()) {\n      zoom = Math.round(zoom);\n\n      this.state.tileLayers.push(new TileLayer(this, zoom));\n      // this.state.tileLayers[0].tilesZoomLevel = this.options.zoom;\n\n      this.state.lastZoomEventActionTime = window.performance.now();\n      this.state.zoomAnimationStart = window.performance.now();\n      this.state.targetZoom = zoom;\n      this.state.startZoom = this.options.zoom;\n    }\n  }\n\n  setCenter(coord) {\n    if (!Array.isArray(coord) || coord.length !== 2) {\n      throw new Error('Please provide a valid array with a lat/lon');\n    }\n\n    coord = coord.map(coord => parseFloat(coord));\n\n    this.state.moveAnimationStart = window.performance.now();\n    this.state.targetMoveOffset = coord;\n    this.state.targetMoveOffsetIsCoord = true;\n  }\n\n  setTargetMoveOffset(x, y, animated = true) {\n    if (animated) {\n      this.state.moveAnimationStart = window.performance.now();\n\n      this.state.targetMoveOffset = TileConversion.pixelToLatLon(\n        [x, y],\n        this.options.center,\n        this.options.zoom,\n        this.options.tileSize\n      );\n\n      this.state.targetMoveOffsetIsCoord = true;\n    } else {\n      this.state.targetMoveOffset = [x, y];\n      this.state.targetMoveOffsetIsCoord = false;\n\n      this.state.moveOffset = this.state.targetMoveOffset;\n    }\n  }\n\n  zoomValueIsValid(zoom) {\n    return zoom >= 1 && zoom <= 18;\n  }\n\n  isReadyForZoomEvent() {\n    if (!this.state.lastZoomEventActionTime) {\n      return true;\n    }\n\n    const now = window.performance.now();\n    const milliSecondsSinceLastEvent = now - this.state.lastZoomEventActionTime;\n\n    return milliSecondsSinceLastEvent > this.options.debounceIntervalMs;\n  }\n\n  calculateVelocity(position1, position2, time1, time2) {\n    return ((position1 - position2) / (time1 - time2)) * 1000;\n  }\n\n  attachEvents() {\n    this.canvas.addEventListener('wheel', event => {\n      event.preventDefault();\n\n      if (event.deltaY > 5) {\n        this.setZoom(this.options.zoom - 1);\n      } else if (event.deltaY < -5) {\n        this.setZoom(this.options.zoom + 1);\n      }\n    });\n\n    this.canvas.addEventListener('dblclick', event => {\n      event.preventDefault();\n      this.updateMousePosition(event);\n\n      const canvasCenter = this.getCanvasCenter();\n\n      this.setTargetMoveOffset(\n        -(this.state.mousePosition.x - canvasCenter[0]),\n        -(this.state.mousePosition.y - canvasCenter[1])\n      );\n\n      this.setZoom(this.options.zoom + 1);\n    });\n\n    this.canvas.addEventListener('mousedown', event => {\n      event.preventDefault();\n      this.updateMousePosition(event);\n\n      if (!this.handleMouseEventInteraction(event, 'mousedown')) {\n        this.state.mouseVelocities = [];\n\n        this.state.dragStartPosition = [\n          this.state.mousePosition.x - this.state.moveOffset[0],\n          this.state.mousePosition.y - this.state.moveOffset[1]\n        ];\n      }\n    });\n\n    this.canvas.addEventListener('mouseup', event => {\n      event.preventDefault();\n      this.updateMousePosition(event);\n\n      if (!this.state.dragStartPosition) {\n        this.handleMouseEventInteraction(event, 'mouseup');\n      } else {\n        const x = -(this.state.dragStartPosition[0] - this.state.mousePosition.x);\n        const y = -(this.state.dragStartPosition[1] - this.state.mousePosition.y);\n\n        if (this.state.moveOffset[0] !== 0 || this.state.moveOffset[1] !== 0) {\n          const now = window.performance.now();\n          const timingThreshold = now - this.options.throwTimingThresholdMs;\n\n          const thresholdsToConsider = this.state.mouseVelocities\n            .filter(threshold => threshold[0] > timingThreshold)\n            .map(threshold => threshold[1]);\n\n          const velocitySum = thresholdsToConsider.reduce(\n            (accumulator, velocity) => accumulator + velocity,\n            0\n          );\n\n          const averageVelocity = velocitySum / thresholdsToConsider.length;\n\n          if (averageVelocity >= this.options.throwVelocityThreshold) {\n            let multiplier = averageVelocity / this.options.throwVelocityThreshold\n              * this.options.panAccelerationMultiplier;\n\n            multiplier = Math.min(multiplier, this.options.maxPanAcceleration);\n\n            this.setTargetMoveOffset(\n              x * multiplier,\n              y * multiplier\n            );\n          } else {\n            this.updateCenter();\n          }\n        }\n\n        this.state.dragStartPosition = null;\n      }\n    });\n\n    this.canvas.addEventListener('mousemove', event => {\n      event.preventDefault();\n      this.updateMousePosition(event);\n\n      if (this.state.dragStartPosition) {\n        const x = -(this.state.dragStartPosition[0] - this.state.mousePosition.x);\n        const y = -(this.state.dragStartPosition[1] - this.state.mousePosition.y);\n\n        const now = window.performance.now();\n\n        const vx = this.calculateVelocity(this.state.moveOffset[0], x, now, this.state.lastMouseMoveEvent);\n        const vy = this.calculateVelocity(this.state.moveOffset[1], y, now, this.state.lastMouseMoveEvent);\n\n        const velocity = Math.round(Math.sqrt((vx * vx) + (vy * vy)));\n\n        this.state.mouseVelocities.push([now, velocity]);\n\n        this.setTargetMoveOffset(x, y, false);\n        this.state.lastMouseMoveEvent = window.performance.now();\n      } else {\n        this.handleMouseEventInteraction(event, 'mousemove');\n      }\n\n      return false;\n    });\n  }\n\n  isCurrentlyDraggingMap() {\n    return this.state.dragStartPosition !== null;\n  }\n\n  updateMousePosition(event) {\n    const rect = this.canvas.getBoundingClientRect();\n\n    this.state.mousePosition = {\n      x: event.clientX - rect.left,\n      y: event.clientY - rect.top\n    };\n  }\n\n  easeOutQuad(time) {\n    return time * (2 - time);\n  }\n\n  updateMoveOffset() {\n    const targetMoveOffsetChanged = this.state.moveOffset !== this.state.targetMoveOffset;\n\n    if (targetMoveOffsetChanged) {\n      const timestamp = window.performance.now();\n\n      const progress = Math.max(timestamp - this.state.moveAnimationStart, 0);\n      const percentage = this.easeOutQuad(progress / this.options.animationDurationMs);\n\n      let targetMoveOffset = this.state.targetMoveOffset;\n\n      if (this.state.targetMoveOffsetIsCoord) {\n        targetMoveOffset = TileConversion.latLonToPixel(\n          this.state.targetMoveOffset,\n          this.options.center,\n          this.options.zoom,\n          this.options.tileSize\n        );\n      }\n\n      if (percentage >= 0.99) {\n        this.state.moveOffset = targetMoveOffset;\n      } else {\n        this.state.moveOffset = [\n          this.state.moveOffset[0] + (targetMoveOffset[0] - this.state.moveOffset[0]) * percentage,\n          this.state.moveOffset[1] + (targetMoveOffset[1] - this.state.moveOffset[1]) * percentage\n        ];\n      }\n\n      const targetHasBeenReached = this.state.moveOffset === targetMoveOffset;\n\n      if (targetHasBeenReached) {\n        this.updateCenter();\n      }\n    }\n  }\n\n  updateCenter() {\n    const latLon = TileConversion.pixelToLatLon(\n      this.state.moveOffset,\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize\n    );\n\n    this.setTargetMoveOffset(0, 0, false);\n    this.options.center = latLon;\n  }\n\n  updateZoom() {\n    if (this.options.zoom !== this.state.targetZoom) {\n      const progress = Math.max(window.performance.now() - this.state.zoomAnimationStart, 0);\n      const percentage = this.easeOutQuad(progress / this.options.animationDurationMs);\n\n      let differenceFromTarget = Math.abs(this.state.targetZoom - this.state.startZoom);\n\n      if (this.state.targetZoom <= this.state.startZoom) {\n        differenceFromTarget *= -1;\n      }\n\n      const newZoomDiff = differenceFromTarget * percentage;\n      const remainingTime = this.options.animationDurationMs - progress;\n\n      this.options.zoom = remainingTime <= 5\n        ? this.state.targetZoom\n        : (this.state.startZoom + newZoomDiff);\n\n      const roundedZoom = Math.round(this.options.zoom);\n      const diff = this.options.zoom - roundedZoom;\n\n      this.state.scale = Math.pow(2, diff);\n\n      if (this.options.zoom === this.state.targetZoom) {\n        // Mark old tile layer for deletion\n        this.state.tileLayers.shift();\n        this.state.tileLayers[0].tilesZoomLevel = null;\n\n        // this.state.tileLayers[this.state.tileLayers.length - 1].shouldBeDeleted = true;\n      }\n    } else {\n      this.state.scale = 1;\n    }\n  }\n\n  garbageCollect() {\n    const allTiles = Object.values(this.state.tiles);\n\n    if (allTiles.length > this.maxTilesToKeep()) {\n      const tileExpirationCutOff = new Date().getTime() - 5000;\n\n      const tilesToConsider = allTiles\n        .filter(tile => tile.lastRequested < tileExpirationCutOff)\n        .sort((a, b) => ~~(a.lastRequested < b.lastRequested));\n\n      const tilesToDeleteCount = this.maxTilesToKeep() - (allTiles.length - tilesToConsider.length);\n\n      tilesToConsider\n        .splice(tilesToConsider.length - tilesToDeleteCount)\n        .forEach(tile => {\n          tile.src = '';\n          delete this.state.tiles[tile.tileId];\n        });\n    }\n  }\n\n  maxTilesToKeep() {\n    return 1000;\n  }\n\n  shouldRedraw() {\n    if (this.state.forceRedraw) {\n      this.state.forceRedraw = false;\n\n      return true;\n    }\n\n    const drawState = JSON.stringify([this.state, this.options]);\n\n    if (this.lastDrawState !== drawState) {\n      this.lastDrawState = drawState;\n\n      return true;\n    }\n\n    return false;\n  }\n\n  draw() {\n    this.updateMoveOffset();\n    this.updateZoom();\n    this.state.tileLayers.forEach(tileLayer => tileLayer.calculateGrid());\n    this.garbageCollect();\n\n    if (this.shouldRedraw()) {\n      // Delete tile layers that are ready for deletion and mostly loaded\n      /*\n      this.state.tileLayers = this.state.tileLayers\n        .filter(tileLayer => !(tileLayer.shouldBeDeleted && tileLayer.loadedPercentage() >= 0.9));\n\n      console.log(this.state.tileLayers.length);\n      */\n\n      if (this.state.tileLayers.length > 0) {\n        // Only draw the top layer\n        this.state.tileLayers[0].drawTiles(this.state.scale);\n      }\n\n      this.renderPolygons();\n      this.renderMarkers();\n      this.renderControls();\n      this.renderAttribution();\n    }\n\n    window.requestAnimationFrame(this.draw);\n  }\n\n  getMapBounds() {\n    const canvasCenter = this.getCanvasCenter();\n\n    const nw = TileConversion.pixelToLatLon(\n      [canvasCenter[0], canvasCenter[1]],\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize\n    );\n\n    const se = TileConversion.pixelToLatLon(\n      [-canvasCenter[0], -canvasCenter[1]],\n      this.options.center,\n      this.options.zoom,\n      this.options.tileSize\n    );\n\n    return {\n      nw, se\n    };\n  }\n\n  getVisibleMarkers() {\n    const bounds = this.getMapBounds();\n\n    return this.state.markers.filter(marker => {\n      return marker.coords[0] <= bounds.nw[0] && marker.coords[0] >= bounds.se[0]\n        && marker.coords[1] >= bounds.nw[1] && marker.coords[1] <= bounds.se[1];\n    });\n  }\n\n  getCanvasCenter() {\n    return [\n      this.state.canvasDimensions[0] / 2,\n      this.state.canvasDimensions[1] / 2\n    ];\n  }\n\n  renderMarkers() {\n    const visibleMarkers = this.getVisibleMarkers();\n    const canvasCenter = this.getCanvasCenter();\n\n    visibleMarkers.map(marker => {\n      const position = TileConversion.latLonToPixel(\n        marker.coords,\n        this.options.center,\n        this.options.zoom,\n        this.options.tileSize\n      );\n\n      marker.render(this.context, [\n        canvasCenter[0] - position[0] + this.state.moveOffset[0],\n        canvasCenter[1] - position[1] + this.state.moveOffset[1]\n      ]);\n    });\n  }\n\n  renderPolygons() {\n    const mapState = new MapState(\n      this.options.center,\n      this.options.zoom,\n      this.state.targetZoom,\n      this.options.tileSize,\n      this.state.canvasDimensions,\n      this.state.moveOffset\n    );\n\n    this.state.polygons.map(polygon => {\n      polygon.render(this.context, mapState);\n\n      if (!this.isCurrentlyDraggingMap() && this.onPolygonHover) {\n        polygon.handleMouseOver(this.context, mapState, this.state.mousePosition);\n      }\n    });\n  }\n\n  handleMouseEventInteraction(event, name) {\n    const controlObjects = this.getControlObjects().filter(item => this.isMouseOverObject(item.bounds));\n\n    const markers = controlObjects.length <= 0 && (this.onMarkerClicked || this.onMarkerHover)\n      ? this.getMarkersBounds().filter(item => this.isMouseOverObject(item.bounds))\n      : [];\n\n    if (name === 'mouseup') {\n      if (controlObjects.length > 0) {\n        const controlObject = controlObjects[0];\n\n        this.setZoom(controlObject.label === '+'\n          ? this.options.zoom + 1\n          : this.options.zoom - 1);\n      }\n\n      if (this.onMarkerClicked) {\n        markers.map(item => this.onMarkerClicked(item.marker));\n      }\n    } else {\n      if (this.onMarkerHover) {\n        markers.map(item => this.onMarkerHover(item.marker));\n      }\n    }\n\n    let controlsOrMarkersIsHover = controlObjects.length > 0 || markers.length > 0;\n\n    let polygonIsHover = false;\n\n    if (this.onPolygonHover) {\n      let polygons = [];\n\n      if (!controlsOrMarkersIsHover && !this.isCurrentlyDraggingMap()) {\n        const mapState = new MapState(\n          this.options.center,\n          this.options.zoom,\n          this.state.targetZoom,\n          this.options.tileSize,\n          this.state.canvasDimensions,\n          this.state.moveOffset\n        );\n\n        polygons = this.state.polygons.map(polygon =>\n          polygon.handleMouseOver(null, mapState, this.state.mousePosition)\n        ).filter(polygon => polygon.length > 0);\n      }\n\n      polygonIsHover = polygons.length > 0;\n\n      if (polygonIsHover) {\n        polygons.map(polygon => polygon.map(item => this.onPolygonHover(item)));\n      }\n    }\n\n    this.canvas.style.cursor = controlsOrMarkersIsHover || polygonIsHover\n      ? 'pointer'\n      : 'grab';\n\n    // Let caller know if controls or markers were interacted with. This will prevent further\n    // mouse interactions from being triggered\n    return controlsOrMarkersIsHover;\n  }\n\n  getControlObjects() {\n    const margin = 4;\n    const size = 30;\n\n    return [\n      {\n        bounds: {\n          x: margin,\n          y: margin,\n          width: size,\n          height: size\n        },\n        label: '+'\n      },\n      {\n        bounds: {\n          x: margin,\n          y: margin + size + margin,\n          width: size,\n          height: size\n        },\n        label: '-'\n      }\n    ];\n  }\n\n  getMarkersBounds() {\n    const visibleMarkers = this.getVisibleMarkers();\n    const canvasCenter = this.getCanvasCenter();\n\n    return visibleMarkers.map(marker => {\n      const position = TileConversion.latLonToPixel(\n        marker.coords,\n        this.options.center,\n        this.options.zoom,\n        this.options.tileSize\n      );\n\n      const markerSize = marker.size;\n      const markerOffset = marker.offset;\n\n      return {\n        bounds: {\n          x: canvasCenter[0] - position[0] + this.state.moveOffset[0] - (markerSize[0] / 2) + markerOffset[0],\n          y: canvasCenter[1] - position[1] + this.state.moveOffset[1] - (markerSize[1] / 2) + markerOffset[1],\n          width: markerSize[0],\n          height: markerSize[1]\n        },\n        marker\n      };\n    });\n  }\n\n  renderControls() {\n    this.getControlObjects().map(item => this.renderControl(item.bounds, item.label));\n  }\n\n  renderControl(bounds, label) {\n    const radius = 10;\n\n    // Background\n    this.context.fillStyle = this.isMouseOverObject(bounds)\n      ? 'rgba(100, 100, 100, 0.7)'\n      : 'rgba(0, 0, 0, 0.7)';\n\n    this.roundedRectangle(bounds.x, bounds.y, bounds.width, bounds.height, radius);\n\n    // Text\n    this.context.font = 'bold 25px courier';\n    this.context.textAlign = 'center';\n    this.context.textBaseline = 'middle';\n    this.context.fillStyle = 'rgba(255, 255, 255)';\n\n    this.context.fillText(\n      label,\n      bounds.x + (bounds.width / 2),\n      bounds.y + (bounds.height / 2)\n    );\n  }\n\n  isMouseOverObject(bounds) {\n    return this.state.mousePosition.x >= bounds.x\n      && this.state.mousePosition.x <= bounds.x + bounds.width\n      && this.state.mousePosition.y >= bounds.y\n      && this.state.mousePosition.y <= bounds.y + bounds.height;\n  }\n\n  renderAttribution() {\n    const margin = 4;\n\n    this.context.font = 'bold 12px sans-serif';\n    this.context.textAlign = 'left';\n    this.context.textBaseline = 'alphabetic';\n\n    const textBounds = this.context.measureText(this.options.attribution);\n\n    const x = this.state.canvasDimensions[0] - textBounds.width - margin;\n    const y = this.state.canvasDimensions[1] - 2 - margin;\n\n    this.context.fillStyle = 'rgba(255, 255, 255, 0.7)';\n    this.roundedRectangle(x - margin, y - 15, textBounds.width + 80, 80);\n\n    this.context.fillStyle = 'rgba(0, 0, 0, 0.7)';\n    this.context.fillText(this.options.attribution, x, y);\n  }\n\n  roundedRectangle(x, y, width, height, radius = 5) {\n    this.context.beginPath();\n    this.context.moveTo(x + radius, y);\n    this.context.lineTo(x + width - radius, y);\n    this.context.quadraticCurveTo(x + width, y, x + width, y + radius);\n    this.context.lineTo(x + width, y + height - radius);\n    this.context.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\n    this.context.lineTo(x + radius, y + height);\n    this.context.quadraticCurveTo(x, y + height, x, y + height - radius);\n    this.context.lineTo(x, y + radius);\n    this.context.quadraticCurveTo(x, y, x + radius, y);\n    this.context.closePath();\n\n    this.context.fill();\n  }\n\n  addMarker(marker) {\n    this.state.markers.push(marker);\n  }\n\n  addMarkers(markers) {\n    markers.map(marker => this.addMarker(marker));\n  }\n\n  setMarkers(markers) {\n    this.state.markers = markers;\n    this.state.forceRedraw = true;\n  }\n\n  addPolygon(polygon) {\n    this.state.polygons.push(polygon);\n  }\n\n  setPolygons(polygons) {\n    this.state.polygons = polygons;\n  }\n\n}\n","export default class MapState {\n  constructor(center, zoom, targetZoom, tileSize, canvasDimensions, moveOffset) {\n    this._center = center;\n    this._zoom = zoom;\n    this._targetZoom = targetZoom;\n    this._tileSize = tileSize;\n    this._canvasDimensions = canvasDimensions;\n    this._moveOffset = moveOffset;\n  }\n\n  get center() {\n    return this._center;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get targetZoom() {\n    return this._targetZoom;\n  }\n\n  get tileSize() {\n    return this._tileSize;\n  }\n\n  get canvasDimensions() {\n    return this._canvasDimensions;\n  }\n\n  get moveOffset() {\n    return this._moveOffset;\n  }\n}\n","import { defaultMarkerOptions } from './defaultOptions';\n\nexport default class Marker {\n  constructor(coords, options = {}) {\n    this._coords = coords;\n    this._options = Object.assign({}, defaultMarkerOptions, options);\n  }\n\n  get coords() {\n    return this._coords;\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  get size() {\n    switch (this.options.type) {\n      case 'marker':\n        return [\n          17.698069,\n          24.786272\n        ];\n\n      case 'circle':\n        return [10, 10];\n\n      case 'donut':\n        return [14, 14];\n\n      case 'image':\n        return this.options.image\n          ? [this.options.image.width, this.options.image.height]\n          : null;\n\n      default:\n        return null;\n    }\n  }\n\n  get offset() {\n    switch (this.options.type) {\n      case 'marker':\n        return [\n          0,\n          -(this.size[1] / 2)\n        ];\n\n      case 'image':\n        return this.options.offset;\n\n      default:\n        return [0, 0];\n    }\n  }\n\n  render(context, position) {\n    let renderFunction = null;\n\n    switch (this.options.type) {\n      case 'marker':\n        renderFunction = this.renderMarker;\n        break;\n\n      case 'circle':\n        renderFunction = this.renderCircle;\n        break;\n\n      case 'donut':\n        renderFunction = this.renderDonut;\n        break;\n\n      case 'image':\n        renderFunction = this.renderImage;\n        break;\n    }\n\n    if (!renderFunction) {\n      throw new Error(`Unsupported marker type: \"${this.options.type}\"`);\n    } else {\n      context.fillStyle = this.options.color;\n      context.strokeStyle = this.options.color;\n\n      renderFunction = renderFunction.bind(this);\n      renderFunction(context, position);\n    }\n  }\n\n  renderCircle(context, position) {\n    context.save();\n    context.beginPath();\n    context.arc(position[0], position[1], this.size[0] / 2, 0, 2 * Math.PI);\n    context.fill();\n    context.restore();\n  }\n\n  renderDonut(context, position) {\n    context.save();\n    context.beginPath();\n    context.lineWidth = 5;\n    context.arc(position[0], position[1], this.size[0] / 2, 0, 2 * Math.PI);\n    context.stroke();\n    context.restore();\n  }\n\n  renderMarker(context, position) {\n    const size = this.size;\n\n    const x = position[0] - size[0] / 2;\n    const y = position[1] - size[1];\n\n    context.save();\n    context.transform(0.184386, 0.000000, 0.000000, 0.184386, 0.551658 + x, 4.095760 + y);\n    context.beginPath();\n    context.lineWidth = 1.667195;\n    context.moveTo(45.000000, -22.212949);\n    context.bezierCurveTo(18.494941, -22.212949, -2.991863, -0.726145, -2.991863, 25.778914);\n    context.bezierCurveTo(-2.991863, 52.282306, 45.000000, 112.212950, 45.000000, 112.212950);\n    context.bezierCurveTo(45.000000, 112.212950, 92.991863, 52.282306, 92.991863, 25.777247);\n    context.bezierCurveTo(92.991863, -0.726145, 71.505059, -22.212949, 45.000000, -22.212949);\n    context.moveTo(45.000000, 43.827962);\n    context.bezierCurveTo(33.553042, 43.827962, 24.273437, 34.550024, 24.273437, 23.103067);\n    context.bezierCurveTo(24.273437, 11.656109, 33.553042, 2.376504, 45.000000, 2.376504);\n    context.bezierCurveTo(56.446958, 2.376504, 65.726563, 11.654442, 65.726563, 23.101399);\n    context.bezierCurveTo(65.726563, 34.548357, 56.446958, 43.827962, 45.000000, 43.827962);\n    context.fill();\n    context.restore();\n  }\n\n  renderImage(context, position) {\n    if (this.options.image) {\n      const size = this.size;\n      const x = position[0] - size[0] / 2 + this.offset[0];\n      const y = position[1] - size[1] / 2 + this.offset[1];\n\n      context.drawImage(this.options.image, x, y, size[0], size[1]);\n    }\n  }\n}\n","import { defaultPolygonOptions, defaultPolygonHoverOptions } from './defaultOptions';\nimport TileConversion from './TileConversion';\nimport { feature } from 'topojson-client';\nimport classifyPoint from 'robust-point-in-polygon';\n\nexport default class Polygon {\n  constructor(json, objectName, options = {}, hoverOptions = null) {\n    this._options = Object.assign({}, defaultPolygonOptions, options);\n    this._hoverOptions = Object.assign({}, defaultPolygonOptions, defaultPolygonHoverOptions, hoverOptions);\n    this.globalIndex = this.prepareGlobalDataObject();\n\n    if (!objectName) {\n      objectName = Object.keys(json.objects)[0];\n    }\n\n    if (!(objectName in json.objects)) {\n      throw new Error(`Invalid object name, valid options are: ${Object.keys(json.objects).join(', ')}`);\n    }\n\n    this.geometry = feature(json, json.objects[objectName]);\n  }\n\n  get options() {\n    return this._options;\n  }\n\n  get hoverOptions() {\n    return this._hoverOptions;\n  }\n\n  get geometry() {\n    return window.lightningMapsPolygons[this.globalIndex].geometry;\n  }\n\n  set geometry(geometry) {\n    window.lightningMapsPolygons[this.globalIndex].geometry = geometry;\n  }\n\n  get projectedGeometry() {\n    return window.lightningMapsPolygons[this.globalIndex].projectedGeometry;\n  }\n\n  set projectedGeometry(projectedGeometry) {\n    window.lightningMapsPolygons[this.globalIndex].projectedGeometry = projectedGeometry;\n  }\n\n  prepareGlobalDataObject() {\n    if (!('lightningMapsPolygons' in window)) {\n      window.lightningMapsPolygons = [];\n    }\n\n    const index = window.lightningMapsPolygons.length;\n\n    window.lightningMapsPolygons[index] = {\n      geometry: null,\n      projectedGeometry: null\n    };\n\n    return index;\n  }\n\n  handleMouseOver(context, mapState, mousePosition) {\n    const currentlyZooming = Math.round(mapState.zoom) !== mapState.zoom;\n\n    if (!this.geometry || !this.projectedGeometry || currentlyZooming) {\n      return [];\n    }\n\n    const canvasCenter = [\n      mapState.canvasDimensions[0] / 2,\n      mapState.canvasDimensions[1] / 2\n    ];\n\n    const originZoom = this.determineOriginZoom(mapState);\n    const centerOffset = this.calculateCenterOffset(mapState, originZoom);\n    const point = [\n      mousePosition.x - centerOffset[0] - canvasCenter[0],\n      mousePosition.y - centerOffset[1] - canvasCenter[1]\n    ];\n\n    return this.projectedGeometry.filter(item => {\n      const isHover = item.geometry.filter(list => classifyPoint(list, point) === -1).length > 0;\n\n      if (isHover && context) {\n        context.beginPath();\n\n        item.geometry.map((list) => {\n          list.map((position, index) => {\n            position = [\n              position[0] + centerOffset[0] + canvasCenter[0],\n              position[1] + centerOffset[1] + canvasCenter[1]\n            ];\n\n            if (index === 0) {\n              context.moveTo(position[0], position[1]);\n            } else {\n              context.lineTo(position[0], position[1]);\n            }\n          });\n        });\n\n        this.applyContextStyles(context, this.hoverOptions, mapState.zoom);\n\n        if (this.options.enableStroke) context.fill();\n        if (this.options.enableFill) context.stroke();\n      }\n\n      return isHover;\n    });\n  }\n\n  calculateCenterOffset(mapState, originZoom) {\n    return [\n      -(TileConversion.lon2tile(mapState.center[1], originZoom, false) * mapState.tileSize),\n      -(TileConversion.lat2tile(mapState.center[0], originZoom, false) * mapState.tileSize)\n    ];\n  }\n\n  render(context, mapState) {\n    if (!this.geometry) {\n      return;\n    }\n\n    const originZoom = this.determineOriginZoom(mapState);\n\n    const zoomDiff = originZoom\n      ? mapState.zoom - originZoom\n      : 0;\n\n    const scale = zoomDiff !== 0\n      ? Math.pow(2, zoomDiff)\n      : 1;\n\n    const mapCenterChanged = this.renderedMapCenter !== mapState.center,\n      mapZoomChanged = (zoomDiff === 0 && this.renderedZoomLevel !== mapState.zoom);\n\n    const shouldReRender = mapCenterChanged || mapZoomChanged;\n\n    let centerOffset = null;\n\n    if (shouldReRender) {\n      this.renderedZoomLevel = mapState.zoom;\n      this.renderedMapCenter = mapState.center;\n\n      this.projectedGeometry = this.geometry.features.map(feature => {\n        return {\n          ...feature,\n          geometry: this.projectGeometry(feature.geometry, mapState)\n        };\n      });\n\n      centerOffset = this.calculateCenterOffset(mapState, originZoom);\n\n      this.calculatePolygonExtends(centerOffset);\n    }\n\n    const canvasCenter = [\n      mapState.canvasDimensions[0] / 2,\n      mapState.canvasDimensions[1] / 2\n    ];\n\n    const imagePosition = [\n      canvasCenter[0] + mapState.moveOffset[0] + (this.polygonExtends.minX * scale),\n      canvasCenter[1] + mapState.moveOffset[1] + (this.polygonExtends.minY * scale)\n    ];\n\n    const imageRect = {\n      left: Math.floor(imagePosition[0] * -1),\n      right: Math.ceil(Math.abs(imagePosition[0]) + mapState.canvasDimensions[0]),\n      top: Math.floor(imagePosition[1] * -1),\n      bottom: Math.ceil(Math.abs(imagePosition[1]) + mapState.canvasDimensions[1])\n    };\n\n    if (shouldReRender) {\n      this.renderOffscreenCanvas(mapState, centerOffset, imageRect);\n    }\n\n    const imageDrawPosition = [\n      mapState.moveOffset[0] - (canvasCenter[0] * (scale - 1)),\n      mapState.moveOffset[1] - (canvasCenter[1] * (scale - 1))\n    ];\n\n    const scaledWidth = this.polygonDimensions[0] * scale,\n      scaledHeight = this.polygonDimensions[1] * scale;\n\n    context.drawImage(\n      this.offscreenCanvas,\n      imageDrawPosition[0], imageDrawPosition[1],\n      scaledWidth, scaledHeight\n    );\n  }\n\n  determineOriginZoom(mapState) {\n    let originZoom = mapState.zoom;\n\n    if (mapState.targetZoom > mapState.zoom) { // Zoming in\n      originZoom = Math.floor(mapState.zoom);\n    } else if (mapState.targetZoom < mapState.zoom) { // Zooming out\n      originZoom = Math.ceil(mapState.zoom);\n    }\n\n    return originZoom;\n  }\n\n  createOffscreenCanvas(clipRect) {\n    this.polygonDimensions = [\n      clipRect.right - clipRect.left,\n      clipRect.bottom - clipRect.top\n    ];\n\n    this.offscreenCanvas = document.createElement('canvas');\n    this.offscreenCanvas.width = this.polygonDimensions[0];\n    this.offscreenCanvas.height = this.polygonDimensions[1];\n\n    return this.offscreenCanvas.getContext('2d');\n  }\n\n  calculatePolygonExtends(centerOffset) {\n    let minX, maxX, minY, maxY = null;\n\n    this.mapGeometry(position => {\n      position = [\n        position[0] + centerOffset[0],\n        position[1] + centerOffset[1]\n      ];\n\n      if (!maxX || position[0] > maxX) {\n        maxX = position[0];\n      }\n\n      if (!minX || position[0] < minX) {\n        minX = position[0];\n      }\n\n      if (!maxY || position[1] > maxY) {\n        maxY = position[1];\n      }\n\n      if (!minY || position[1] < minY) {\n        minY = position[1];\n      }\n    });\n\n    this.polygonDimensions = [\n      Math.ceil(maxX - minX),\n      Math.ceil(maxY - minY)\n    ];\n\n    this.polygonExtends = {\n      minX, maxX,\n      minY, maxY\n    };\n  }\n\n  renderOffscreenCanvas(mapState, centerOffset, clipRect) {\n    const offscreenContext = this.createOffscreenCanvas(clipRect);\n\n    offscreenContext.beginPath();\n    offscreenContext.font = 'bold 8px helvetica';\n\n    this.projectedGeometry.map((item) =>\n      item.geometry.map((list) => {\n        const pointsInClipRect = list.filter(position => {\n          position = [\n            position[0] - this.polygonExtends.minX + centerOffset[0],\n            position[1] - this.polygonExtends.minY + centerOffset[1]\n          ];\n\n          return position[0] >= clipRect.left && position[0] <= clipRect.right\n           && position[1] >= clipRect.top && position[1] <= clipRect.bottom;\n        });\n\n        if (pointsInClipRect.length > 0) {\n          list.map((position, index) => {\n            position = [\n              position[0] - this.polygonExtends.minX + centerOffset[0] - clipRect.left,\n              position[1] - this.polygonExtends.minY + centerOffset[1] - clipRect.top\n            ];\n\n            if (index === 0) {\n              // offscreenContext.fillText(item.properties.NAME, position[0], position[1]);\n\n              offscreenContext.moveTo(position[0], position[1]);\n            } else {\n              offscreenContext.lineTo(position[0], position[1]);\n            }\n          });\n        }\n      })\n    );\n\n    this.applyContextStyles(offscreenContext, this.options, mapState.zoom);\n\n    if (this.options.enableStroke) offscreenContext.fill();\n    if (this.options.enableFill) offscreenContext.stroke();\n  }\n\n  applyContextStyles(context, options, zoom) {\n    context.fillStyle = options.fillStyle;\n    context.strokeStyle = options.strokeStyle;\n    context.lineWidth = options.lineWidth * zoom;\n    context.setLineDash(options.lineDash);\n    context.lineJoin = 'round';\n  }\n\n  mapGeometry(pointCallback) {\n    return this.projectedGeometry.map((item) =>\n      item.geometry.map((list) =>\n        list.map(pointCallback)\n      )\n    );\n  }\n\n  projectGeometry(geometry, mapState) {\n    if (geometry) {\n      switch (geometry.type) {\n        case 'Polygon':\n          return [geometry.coordinates[0].map(item => this.projectPoint(mapState, item[0], item[1]))];\n\n        case 'MultiPolygon':\n          return geometry.coordinates.map(coordinates =>\n            coordinates[0].map(item => this.projectPoint(mapState, item[0], item[1]))\n          );\n      }\n    }\n\n    return [];\n  }\n\n  projectPoint(mapState, x, y) {\n    const position = TileConversion.latLonToPixel(\n      [y, x],\n      null,\n      mapState.zoom,\n      mapState.tileSize\n    );\n\n    return [-position[0], -position[1]];\n  }\n}\n","export default class Tile {\n  constructor(x, y, zoom) {\n    this._x = x;\n    this._y = y;\n    this._zoom = zoom;\n  }\n\n  get x() {\n    return this._x;\n  }\n\n  get y() {\n    return this._y;\n  }\n\n  get zoom() {\n    return this._zoom;\n  }\n\n  get id() {\n    return [this.x, this.y, this.zoom].join('|');\n  }\n\n  isValid() {\n    const max = (1 << this.zoom);\n\n    if (this.x >= max || this.x < 0 || this.y >= max || this.y < 0) {\n      return false;\n    }\n\n    return true;\n  }\n}\n","// Based on https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#ECMAScript_.28JavaScript.2FActionScript.2C_etc..29\nexport default class TileConversion {\n  static lon2tile(lon, zoom, rounded = true) {\n    const tile = (lon + 180) / 360 * Math.pow(2, zoom);\n\n    return rounded\n      ? Math.floor(tile)\n      : tile;\n  }\n\n  static lat2tile(lat, zoom, rounded = true) {\n    const tile = (1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180))\n      / Math.PI) / 2 * Math.pow(2, zoom);\n\n    return rounded\n      ? Math.floor(tile)\n      : tile;\n  }\n\n  static tile2lon(x, z) {\n    return x / Math.pow(2, z) * 360 - 180;\n  }\n\n  static tile2lat(y, z) {\n    const n = Math.PI - 2 * Math.PI * y / Math.pow(2, z);\n\n    return 180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n)));\n  }\n\n  static tile2boundingBox(x, y, zoom) {\n    return {\n      ne: [\n        TileConversion.tile2lat(y, zoom),\n        TileConversion.tile2lon(x + 1, zoom)\n      ],\n\n      sw: [\n        TileConversion.tile2lat(y + 1, zoom),\n        TileConversion.tile2lon(x, zoom)\n      ]\n    };\n  }\n\n  static pixelToLatLon(pixel, center, zoom, tileSize) {\n    const pointDiff = [\n      pixel[0] / tileSize,\n      pixel[1] / tileSize\n    ];\n\n    const tileX = TileConversion.lon2tile(center[1], zoom, false) - pointDiff[0];\n    const tileY = TileConversion.lat2tile(center[0], zoom, false) - pointDiff[1];\n\n    return [\n      TileConversion.tile2lat(tileY, zoom),\n      TileConversion.tile2lon(tileX, zoom)\n    ];\n  }\n\n  static latLonToPixel(coord, center, zoom, tileSize) {\n    const tileX = TileConversion.lon2tile(coord[1], zoom, false);\n    const tileY = TileConversion.lat2tile(coord[0], zoom, false);\n\n    let tileCenterX = 0, tileCenterY = 0;\n\n    if (center) {\n      tileCenterX = TileConversion.lon2tile(center[1], zoom, false);\n      tileCenterY = TileConversion.lat2tile(center[0], zoom, false);\n    }\n\n    return [\n      -(tileX - tileCenterX) * tileSize,\n      -(tileY - tileCenterY) * tileSize\n    ];\n  }\n}\n","import TileConversion from './TileConversion';\nimport Tile from './Tile';\n\nexport default class TileLayer {\n\n  constructor(map, tilesZoomLevel = null) {\n    this.map = map;\n    this.tilesZoomLevel = tilesZoomLevel;\n    this.shouldBeDeleted = false;\n\n    this.context = map.context;\n\n    this.state = {\n      grid: [],\n      gridHash: null,\n      relativeTileOffset: [0, 0]\n    };\n  }\n\n  toJSON() {\n    return [\n      this.state,\n      this.loadedPercentage() // We want a change in loaded tiles to possibly trigger a redraw\n    ];\n  }\n\n  getTilesCount(canvasSize) {\n    let tilesCount = Math.ceil(canvasSize / this.map.options.tileSize) * this.map.options.tileAreaMultiplier;\n\n    if (tilesCount % 2 === 0) {\n      tilesCount++;\n    }\n\n    return tilesCount;\n  }\n\n  calculateGrid() {\n    const { state, options } = this.map;\n\n    const centerY = TileConversion.lat2tile(options.center[0], Math.round(this.tilesZoomLevel || options.zoom), false);\n    const centerX = TileConversion.lon2tile(options.center[1], Math.round(this.tilesZoomLevel || options.zoom), false);\n    const gridHash = [centerY, centerX].join(',');\n\n    const gridNeedsToBeUpdated = this.state.gridHash !== gridHash;\n\n    if (!gridNeedsToBeUpdated) {\n      return;\n    }\n\n    const horizontalTiles = this.getTilesCount(state.canvasDimensions[0]);\n    const verticalTiles = this.getTilesCount(state.canvasDimensions[1]);\n\n    // noinspection JSSuspiciousNameCombination\n    const centerYRounded = Math.floor(centerY);\n    const centerXRounded = Math.floor(centerX);\n\n    this.state.relativeTileOffset = [\n      Math.abs(centerX - centerXRounded),\n      Math.abs(centerY - centerYRounded)\n    ];\n\n    const startX = centerXRounded - Math.floor(horizontalTiles / 2);\n    const startY = centerYRounded - Math.floor(verticalTiles / 2);\n\n    let grid = [];\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        if (!grid[x]) {\n          grid[x] = [];\n        }\n\n        const tileX = startX + x;\n        const tileY = startY + y;\n\n        const tile = new Tile(tileX, tileY, Math.round(this.tilesZoomLevel || options.zoom));\n\n        if (tile.isValid()) {\n          this.ensureTileAsset(tile);\n          grid[x][y] = tile;\n        }\n      }\n    }\n\n    this.state.grid = grid;\n    this.state.gridHash = gridHash;\n  }\n\n  ensureTileAsset(tile) {\n    if (!(tile.id in this.map.state.tiles)) {\n      const tileUrl = this.map.options.source(Math.floor(tile.x), Math.floor(tile.y), tile.zoom);\n\n      this.map.state.tiles[tile.id] = new Image();\n      this.map.state.tiles[tile.id].tileId = tile.id;\n      this.map.state.tiles[tile.id].src = tileUrl;\n      this.map.state.tiles[tile.id].loaded = false;\n      this.map.state.tiles[tile.id].onload = () => {\n        this.map.state.tiles[tile.id].loaded = true;\n      };\n    }\n\n    this.map.state.tiles[tile.id].lastRequested = new Date().getTime();\n  }\n\n  drawTiles(scale) {\n    const canvasWidth = this.map.state.canvasDimensions[0];\n    const canvasHeight = this.map.state.canvasDimensions[1];\n\n    const tileSize = this.map.options.tileSize * scale;\n\n    const centerOffset = [\n      tileSize / 2 - (this.state.relativeTileOffset[0] * tileSize),\n      tileSize / 2 - (this.state.relativeTileOffset[1] * tileSize)\n    ];\n\n    this.context.fillStyle = '#EEE';\n    this.context.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    const horizontalTiles = this.getTilesCount(canvasWidth);\n    const verticalTiles = this.getTilesCount(canvasHeight);\n\n    const horizontalOverflow = (horizontalTiles * tileSize) - canvasWidth;\n    const verticalOverflow = (verticalTiles * tileSize) - canvasHeight;\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        const tile = this.state.grid[x][y];\n\n        if (tile) {\n          const tileX = this.map.state.moveOffset[0] + centerOffset[0]\n            + (x * tileSize - horizontalOverflow / 2);\n\n          const tileY = this.map.state.moveOffset[1] + centerOffset[1]\n            + (y * tileSize - verticalOverflow / 2);\n\n          try {\n            if (this.map.state.tiles[tile.id].loaded) {\n              this.context.drawImage(this.map.state.tiles[tile.id], tileX, tileY, tileSize, tileSize);\n            } else {\n              this.drawGenericBackground(tileX, tileY, tileSize);\n            }\n          } catch (err) {\n            this.drawGenericBackground(tileX, tileY, tileSize);\n          }\n\n          if (this.map.options.debug) {\n            this.context.strokeStyle = 'green';\n            this.context.strokeRect(tileX, tileY, tileSize, tileSize);\n          }\n        }\n      }\n    }\n\n    if (this.map.options.debug) {\n      this.context.fillStyle = 'rgba(200, 0, 0, 0.7)';\n      this.context.beginPath();\n      this.context.arc(canvasWidth / 2, canvasHeight / 2, 5, 0, 2 * Math.PI);\n      this.context.fill();\n    }\n  }\n\n  drawGenericBackground(x, y, size) {\n    const increment = size / 8;\n\n    this.context.beginPath();\n    for (let lineX = increment; lineX < size; lineX += increment) {\n      for (let lineY = increment; lineY < size; lineY += increment) {\n        this.context.moveTo(x, y + lineY);\n        this.context.lineTo(x + size, y + lineY);\n\n        this.context.moveTo(x + lineX, y);\n        this.context.lineTo(x + lineX, y + size);\n      }\n    }\n    this.context.strokeStyle = '#DDD';\n    this.context.stroke();\n\n    this.context.strokeStyle = '#CCC';\n    this.context.strokeRect(x, y, size, size);\n  }\n\n  loadedPercentage() {\n    const horizontalTiles = this.getTilesCount(this.map.state.canvasDimensions[0]);\n    const verticalTiles = this.getTilesCount(this.map.state.canvasDimensions[1]);\n\n    let totalTiles = 0, loadedTiles = 0;\n\n    for (let y = 0; y < verticalTiles; y++) {\n      for (let x = 0; x < horizontalTiles; x++) {\n        const tile = this.state.grid[x][y];\n\n        if (tile) {\n          totalTiles++;\n        }\n\n        const cachedTile = tile && this.map.state.tiles[tile.id];\n\n        if (cachedTile && cachedTile.loaded) {\n          loadedTiles++;\n        }\n      }\n    }\n\n    return loadedTiles / totalTiles;\n  }\n}\n","export const defaultMapOptions = {\n  /**\n   * Common options\n   */\n  source: (x, y, z) => `https://maps.geocod.io/tiles/base/${z}/${x}/${y}.png`,\n  zoom: 12,\n  center: [38.841779, -77.088312],\n  attribution: ' OpenStreetMap contributors',\n\n  /**\n   * Width and height in pixels for each tile, you most likely do not want to change this.\n   */\n  tileSize: 256,\n\n  /**\n   * Determines the distance travelled when panning the map, the higher the value the further the\n   * distance\n   */\n  panAccelerationMultiplier: 2,\n\n  /**\n   * The maximum acceleration constant for when the map is thrown. This is in place to avoid\n   * super-sonic acceleration speeds :)\n   */\n  maxPanAcceleration: 3.5,\n\n  /**\n   * Only consider high velocity mouse movements that has been performed within this timing\n   * threshold (in milliseconds)\n   */\n  throwTimingThresholdMs: 100,\n\n  /**\n   * If the mouse panning velocity is above this threshold, it is considering a throw rather than\n   * a regular pan. We use this to pan further when the mouse is moved quickly\n   */\n  throwVelocityThreshold: 3000,\n\n  /**\n   * How quickly panning and zooming animations are executed (in milliseconds)\n   */\n  animationDurationMs: 300,\n\n  /*\n   * Used for debouncing events such as scrolling\n   * Note: Needs to be greater than the animationDurationMs value\n   */\n  debounceIntervalMs: 350,\n\n  /**\n   * Determines how many additional tiles that should be loaded, to decrease map load times when\n   * panning the map around\n\n   * Minimum value: 1.25\n   */\n  tileAreaMultiplier: 2,\n\n  /**\n   * When debug mode is enabled, additional rendering artifacts are drawn. Should only be used in\n   * conjuction with development of the library\n   */\n  debug: false\n};\n\nexport const defaultMarkerOptions = {\n  /**\n   * What color should the marker be?\n   * Supports hex, rgb and rgba values\n   */\n  color: 'rgba(0, 0, 200, 0.7)',\n\n  /**\n   * Valid values: marker, circle, donut, image\n   */\n  type: 'marker',\n\n  /**\n   * Image object for the rendered icon\n   * Note: Only used for markers with the \"image\" type\n   */\n  image: null,\n\n  /**\n   * Horizontal and vertical offset.\n   * When the offset is set to [0,0], the image is centered horizontally and vertically.\n   * You might for example want add a vertical offset to teardrop-shaped marker icons\n   * Note: Only used for markers with the \"image\" type\n   */\n  offset: [0, 0]\n};\n\nexport const defaultPolygonOptions = {\n  /**\n   * Whether the polygon should have a stroked line\n   */\n  enableStroke: true,\n\n  /**\n   * What color should the polygon lines be?\n   * Supports hex, rgb and rgba values\n   */\n  strokeStyle: 'rgba(50, 25, 50, 1.0)',\n\n  /**\n   * Specify distances to alternately draw a line and a gap to form\n   * a dashed or dotted line. Line will be solid if array is empty\n   */\n  lineDash: [],\n\n  /**\n   * Specify the thickness of polygon lines. The width scales with the zoom level, so the actual\n   * width in pixels is: lineWidth * zoom\n   */\n  lineWidth: 0.25,\n\n  /**\n   * Whether the polygon should be filled with a color\n   */\n  enableFill: true,\n\n  /**\n   * What color should the polygon be filled with?\n   * Supports hex, rgb and rgba values\n   */\n  fillStyle: 'rgba(0, 0, 0, 0.2)'\n};\n\nexport const defaultPolygonHoverOptions = {\n  strokeStyle: 'red',\n  lineWidth: 0.5\n};\n\n","import Map from './Map';\nimport Marker from './Marker';\nimport Polygon from './Polygon';\n\nexport {\n  Map,\n  Marker,\n  Polygon\n};\n"],"sourceRoot":""}